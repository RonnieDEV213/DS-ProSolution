---
phase: 23-theme-presets-switching
plan: 03
type: execute
wave: 3
depends_on: ["23-01", "23-02"]
files_modified:
  - apps/web/src/components/profile/theme-picker.tsx
  - apps/web/src/components/profile/profile-settings-dialog.tsx
  - apps/web/src/components/admin/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Theme picker UI shows 5 options (System + 4 named themes) with visual preview cards"
    - "Clicking a theme preview card switches the active theme with smooth cross-fade animation"
    - "ProfileSettingsDialog has a 'Theme' tab that renders the theme picker"
    - "Sidebar footer has a theme toggle button that opens a popover with theme options"
    - "Active theme is visually highlighted in both picker locations"
  artifacts:
    - path: "apps/web/src/components/profile/theme-picker.tsx"
      provides: "Theme picker component with preview cards"
      exports: ["ThemePicker", "ThemePickerCompact"]
    - path: "apps/web/src/components/profile/profile-settings-dialog.tsx"
      provides: "Updated dialog with Theme tab"
      contains: "ThemePicker"
    - path: "apps/web/src/components/admin/sidebar.tsx"
      provides: "Sidebar footer with theme toggle popover"
      contains: "ThemePickerCompact"
  key_links:
    - from: "apps/web/src/components/profile/theme-picker.tsx"
      to: "apps/web/src/lib/themes.ts"
      via: "Imports THEMES array for preview data"
      pattern: "import.*THEMES.*from.*lib/themes"
    - from: "apps/web/src/components/profile/theme-picker.tsx"
      to: "apps/web/src/lib/view-transitions.ts"
      via: "Uses withViewTransition for smooth theme switching"
      pattern: "withViewTransition"
    - from: "apps/web/src/components/profile/theme-picker.tsx"
      to: "next-themes"
      via: "useTheme hook for getting/setting theme"
      pattern: "useTheme"
---

<objective>
Create the theme picker UI component with mini preview cards, integrate it into ProfileSettingsDialog as a dedicated "Theme" tab, and add a compact theme popover to the sidebar footer.

Purpose: This is the user-facing surface for theme switching. Users need two access points: full picker in settings (for exploration) and quick toggle in sidebar (for daily use).

Output: New theme-picker.tsx with full and compact variants, updated profile-settings-dialog.tsx with Theme tab, updated sidebar.tsx with theme popover.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-theme-presets-switching/23-CONTEXT.md
@.planning/phases/23-theme-presets-switching/23-RESEARCH.md
@apps/web/src/components/profile/profile-settings-dialog.tsx
@apps/web/src/components/admin/sidebar.tsx
@apps/web/src/lib/themes.ts
@apps/web/src/lib/view-transitions.ts
@apps/web/src/components/ui/popover.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create theme picker component with preview cards (full and compact variants)</name>
  <files>apps/web/src/components/profile/theme-picker.tsx</files>
  <action>
Create `apps/web/src/components/profile/theme-picker.tsx` with two exported components:

**1. `ThemePicker` (full version for ProfileSettingsDialog):**

```tsx
"use client"

import { useTheme } from "next-themes"
import { THEMES, type ThemeConfig } from "@/lib/themes"
import { withViewTransition } from "@/lib/view-transitions"
import { cn } from "@/lib/utils"
import { Check } from "lucide-react" // or use inline SVG if lucide not available
```

Layout: A heading ("Theme"), description text, then a grid of preview cards (2 columns on default, wrapping). Each card shows:
- **Top section (h-20):** Mini UI mockup with sidebar area (left 1/3) and main area (right 2/3)
  - Sidebar shows: small accent-colored bar + two faded text lines
  - Main area shows: heading line + body line + accent-colored button at bottom
  - All using inline `style={{ backgroundColor: theme.preview.xxx }}` so each card shows its OWN theme colors regardless of active theme
- **Bottom section (p-3):** Label, description, checkmark if active
  - Uses `bg-card border-t` classes (inherits current theme)
  - Active card: `border-primary ring-2 ring-primary/20`
  - Inactive card: `border-border hover:border-primary/50`

The "System" card should show a special split preview -- left half dark (Carbon colors), right half light (Dawn colors) -- to communicate auto-detection visually.

On click, call `withViewTransition(() => setTheme(theme.value))`.

**2. `ThemePickerCompact` (compact version for sidebar popover):**

A vertical list of theme options, each showing:
- Small accent color dot (w-3 h-3 rounded-full, inline style with preview.accent)
- Theme label
- Checkmark icon if active

Styled with `hover:bg-muted` for hover state, `bg-primary text-primary-foreground` or subtle highlight for active state.

On click, same `withViewTransition(() => setTheme(theme.value))`.

**For the checkmark icon:** Use an inline SVG (don't add lucide-react dependency if not already installed). Check if lucide-react is in package.json first. If installed, use `<Check className="w-4 h-4" />`. If not, use:
```tsx
<svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
</svg>
```

**Both components use `useTheme()` from next-themes** to get `theme` (the selected theme name) for highlighting active state.

**Styling notes:**
- Use existing Tailwind classes and CSS variable-based colors for the card chrome (border, label area)
- Use inline styles with hardcoded hex values (from themes.ts preview object) for the preview mockup area
- This ensures each preview card always shows its own theme's colors regardless of the active theme
  </action>
  <verify>
1. File exists and exports ThemePicker and ThemePickerCompact
2. ThemePicker renders 5 cards with visual previews
3. ThemePickerCompact renders 5 list items with accent dots
4. Both use withViewTransition for theme changes
5. TypeScript compiles without errors
  </verify>
  <done>
theme-picker.tsx exports ThemePicker (full grid with preview cards for settings dialog) and ThemePickerCompact (vertical list for sidebar popover). Both show 5 theme options with visual differentiation and use View Transitions API for smooth switching.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Theme tab to ProfileSettingsDialog and theme popover to sidebar</name>
  <files>apps/web/src/components/profile/profile-settings-dialog.tsx, apps/web/src/components/admin/sidebar.tsx</files>
  <action>
**Update ProfileSettingsDialog:**

1. Add "theme" to the Tab type:
```tsx
type Tab = "profile" | "security" | "extension" | "theme";
```

2. Add Theme tab button in the nav section (between Extension and Sign Out):
```tsx
<button
  onClick={() => setActiveTab("theme")}
  className={cn(
    "w-full text-left px-3 py-2 rounded text-sm transition-colors",
    activeTab === "theme"
      ? "bg-blue-600 text-white"
      : "text-gray-300 hover:bg-gray-800"
  )}
>
  Theme
</button>
```

3. Add Theme tab content in the main content area:
```tsx
{activeTab === "theme" && <ThemePicker />}
```

Note: Theme tab does NOT depend on userData loading -- it should render even if profile data is still loading. Move the theme tab rendering OUTSIDE the `loading ? ... : userData ? ... : ...` conditional, or make it always render when activeTab is "theme":
```tsx
{activeTab === "theme" ? (
  <ThemePicker />
) : loading ? (
  // loading skeleton
) : userData ? (
  // existing profile/security/extension tabs
) : (
  // error state
)}
```

4. Import ThemePicker:
```tsx
import { ThemePicker } from "./theme-picker";
```

**Update AdminSidebar:**

1. Add imports:
```tsx
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { ThemePickerCompact } from "@/components/profile/theme-picker";
```

2. Add a theme toggle button in the sidebar footer, BEFORE the Profile Settings button (inside the `<div className="p-4 border-t border-gray-800">` section):

```tsx
<Popover>
  <PopoverTrigger asChild>
    <button
      className="flex items-center gap-3 px-4 py-3 w-full rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors"
    >
      {/* Palette icon SVG */}
      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
      </svg>
      Theme
    </button>
  </PopoverTrigger>
  <PopoverContent side="right" align="end" className="w-48 p-2">
    <ThemePickerCompact />
  </PopoverContent>
</Popover>
```

The order in the footer should be: SyncStatusIndicator -> Theme popover button -> Profile Settings button.

**Note about sidebar hardcoded colors:** The sidebar currently uses hardcoded gray classes (bg-gray-900, text-gray-300, etc.). These will be migrated to semantic tokens in Phase 25. For now, match the existing style pattern so the new theme button looks consistent with the existing Profile Settings button.
  </action>
  <verify>
1. ProfileSettingsDialog shows 4 tabs: Profile, Security, Extension, Theme
2. Theme tab renders ThemePicker component with preview cards
3. Theme tab works even while profile data is loading
4. Sidebar footer shows Theme popover trigger before Profile Settings
5. Clicking Theme in sidebar opens popover with compact theme list
6. Both access points allow switching themes with visual transition
7. No TypeScript or import errors
  </verify>
  <done>
ProfileSettingsDialog has a dedicated Theme tab with full preview card picker. AdminSidebar footer has a theme popover for quick switching. Both access points use withViewTransition for smooth cross-fade animation (SWITCH-01, SWITCH-02).
  </done>
</task>

</tasks>

<verification>
1. Theme picker shows 5 options with visual previews in ProfileSettingsDialog
2. Compact theme picker shows 5 options with accent dots in sidebar popover
3. Clicking any theme triggers smooth View Transitions API cross-fade
4. Active theme is visually highlighted (border + checkmark) in both locations
5. System option clearly labeled and shows split preview
6. All theme switches persist via localStorage (handled by next-themes in Plan 02)
</verification>

<success_criteria>
- SWITCH-01 (theme picker in ProfileSettingsDialog with visual previews) fully implemented
- SWITCH-02 (theme transition animation) fully implemented via withViewTransition calls
- Two access points for theme switching: settings dialog (detailed) and sidebar (quick)
- Active theme highlighted in both locations
- 5 options available: System, Midnight, Dawn, Slate, Carbon
</success_criteria>

<output>
After completion, create `.planning/phases/23-theme-presets-switching/23-03-SUMMARY.md`
</output>
