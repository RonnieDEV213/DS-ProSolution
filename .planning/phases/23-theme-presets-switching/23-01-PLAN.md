---
phase: 23-theme-presets-switching
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/globals.css
  - apps/web/src/lib/themes.ts
  - apps/web/src/lib/view-transitions.ts
autonomous: true

must_haves:
  truths:
    - "Four theme CSS variable sets exist (midnight, dawn, slate, carbon) under [data-theme] selectors"
    - "Each theme has a unique accent color (blue, indigo, teal, purple)"
    - "::selection highlights use theme accent color"
    - "accent-color on :root inherits theme primary color for native form controls"
    - "View transition CSS enables 250ms cross-fade with reduced-motion fallback"
    - "Theme metadata (names, labels, descriptions, preview colors) is exported from lib/themes.ts"
    - "View transition utility wraps callbacks with startViewTransition + flushSync"
  artifacts:
    - path: "apps/web/src/app/globals.css"
      provides: "4 theme CSS variable blocks + selection + accent-color + view transition CSS"
      contains: "[data-theme=\"midnight\"]"
    - path: "apps/web/src/lib/themes.ts"
      provides: "Theme metadata for picker UI"
      exports: ["THEMES", "ThemeConfig", "getThemeConfig"]
    - path: "apps/web/src/lib/view-transitions.ts"
      provides: "View transition wrapper utility"
      exports: ["withViewTransition"]
  key_links:
    - from: "apps/web/src/lib/themes.ts"
      to: "apps/web/src/app/globals.css"
      via: "Preview colors match CSS variable values"
      pattern: "oklch"
---

<objective>
Define the 4 theme CSS variable presets (Midnight, Dawn, Slate, Carbon), global CSS utility styles (::selection, accent-color, view transition animation), theme metadata module, and view transition utility function.

Purpose: This is the foundation layer. All subsequent plans depend on these CSS variables existing, the theme metadata being importable, and the view transition utility being available.

Output: globals.css extended with 4 theme presets, new lib/themes.ts with theme metadata, new lib/view-transitions.ts with transition wrapper.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-theme-presets-switching/23-CONTEXT.md
@.planning/phases/23-theme-presets-switching/23-RESEARCH.md
@apps/web/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 4 theme CSS variable presets and global utility styles to globals.css</name>
  <files>apps/web/src/app/globals.css</files>
  <action>
Extend globals.css with the following additions. Keep ALL existing content intact.

**1. Update the dark variant to support multiple dark themes:**
Change the `@custom-variant dark` line to also match midnight, slate, and carbon themes:
```css
@custom-variant dark (&:where([data-theme="dark"], [data-theme="midnight"], [data-theme="slate"], [data-theme="carbon"]) *);
```

**2. Add 4 theme preset blocks in the `@layer base` section, AFTER the existing `[data-theme="dark"]` block:**

Each theme gets a `[data-theme="themename"]` selector with a COMPLETE set of CSS variables (all shadcn tokens + app semantic tokens). The existing `:root` (light) and `[data-theme="dark"]` blocks stay as-is for backward compatibility.

**Midnight theme** `[data-theme="midnight"]` - Blue-undertone dark, Linear's dark mode reference:
- background: oklch(0.12 0.015 250) -- near-black with blue undertone
- foreground: oklch(0.97 0.005 250) -- near-white with slight blue tint
- primary: oklch(0.60 0.18 250) -- blue accent
- primary-foreground: oklch(0.98 0 0)
- card: oklch(0.16 0.018 250)
- card-foreground: oklch(0.97 0.005 250)
- popover: oklch(0.16 0.018 250)
- popover-foreground: oklch(0.97 0.005 250)
- secondary: oklch(0.22 0.02 250)
- secondary-foreground: oklch(0.97 0.005 250)
- muted: oklch(0.22 0.02 250)
- muted-foreground: oklch(0.65 0.02 250)
- accent: oklch(0.22 0.02 250)
- accent-foreground: oklch(0.97 0.005 250)
- destructive: oklch(0.704 0.191 22.216)
- border: oklch(1 0 0 / 10%)
- input: oklch(1 0 0 / 15%)
- ring: oklch(0.60 0.18 250)
- chart-1: oklch(0.60 0.18 250)
- chart-2: oklch(0.696 0.17 162.48)
- chart-3: oklch(0.769 0.188 70.08)
- chart-4: oklch(0.627 0.265 303.9)
- chart-5: oklch(0.645 0.246 16.439)
- sidebar: oklch(0.16 0.018 250)
- sidebar-foreground: oklch(0.97 0.005 250)
- sidebar-primary: oklch(0.60 0.18 250)
- sidebar-primary-foreground: oklch(0.98 0 0)
- sidebar-accent: oklch(0.22 0.02 250)
- sidebar-accent-foreground: oklch(0.97 0.005 250)
- sidebar-border: oklch(1 0 0 / 10%)
- sidebar-ring: oklch(0.60 0.18 250)
- app-bg: oklch(0.12 0.015 250)
- app-sidebar: oklch(0.16 0.018 250)
- app-sidebar-hover: oklch(0.20 0.02 250)
- scrollbar-thumb: oklch(0.45 0.04 250)
- scrollbar-thumb-hover: oklch(0.55 0.06 250)
- scrollbar-track: oklch(0.18 0.018 250)
- table-header-bg: oklch(0.16 0.018 250)
- table-row-hover: oklch(0.20 0.02 250)
- table-border: oklch(1 0 0 / 10%)

**Dawn theme** `[data-theme="dawn"]` - Clean light mode, Vercel/Linear light reference:
- background: oklch(1 0 0)
- foreground: oklch(0.145 0 0)
- primary: oklch(0.488 0.243 264.376) -- indigo accent
- primary-foreground: oklch(0.98 0 0)
- card: oklch(1 0 0)
- card-foreground: oklch(0.145 0 0)
- popover: oklch(1 0 0)
- popover-foreground: oklch(0.145 0 0)
- secondary: oklch(0.96 0.005 264)
- secondary-foreground: oklch(0.205 0 0)
- muted: oklch(0.96 0.005 264)
- muted-foreground: oklch(0.50 0.02 264)
- accent: oklch(0.96 0.005 264)
- accent-foreground: oklch(0.205 0 0)
- destructive: oklch(0.577 0.245 27.325)
- border: oklch(0.90 0.01 264)
- input: oklch(0.90 0.01 264)
- ring: oklch(0.488 0.243 264.376)
- chart-1: oklch(0.488 0.243 264.376)
- chart-2: oklch(0.6 0.118 184.704)
- chart-3: oklch(0.398 0.07 227.392)
- chart-4: oklch(0.828 0.189 84.429)
- chart-5: oklch(0.769 0.188 70.08)
- sidebar: oklch(0.97 0.005 264)
- sidebar-foreground: oklch(0.145 0 0)
- sidebar-primary: oklch(0.488 0.243 264.376)
- sidebar-primary-foreground: oklch(0.98 0 0)
- sidebar-accent: oklch(0.94 0.01 264)
- sidebar-accent-foreground: oklch(0.205 0 0)
- sidebar-border: oklch(0.90 0.01 264)
- sidebar-ring: oklch(0.488 0.243 264.376)
- app-bg: oklch(0.98 0.003 264)
- app-sidebar: oklch(0.96 0.005 264)
- app-sidebar-hover: oklch(0.93 0.008 264)
- scrollbar-thumb: oklch(0.70 0.02 264)
- scrollbar-thumb-hover: oklch(0.60 0.03 264)
- scrollbar-track: oklch(0.92 0.005 264)
- table-header-bg: oklch(0.95 0.005 264)
- table-row-hover: oklch(0.97 0.003 264)
- table-border: oklch(0.90 0.01 264)

**Slate theme** `[data-theme="slate"]` - Warm gray-green dark, between Midnight and Carbon:
- background: oklch(0.17 0.01 160) -- dark warm gray with green undertone
- foreground: oklch(0.95 0.005 160) -- near-white with green tint
- primary: oklch(0.65 0.15 175) -- teal accent
- primary-foreground: oklch(0.98 0 0)
- card: oklch(0.21 0.012 160)
- card-foreground: oklch(0.95 0.005 160)
- popover: oklch(0.21 0.012 160)
- popover-foreground: oklch(0.95 0.005 160)
- secondary: oklch(0.25 0.015 160)
- secondary-foreground: oklch(0.95 0.005 160)
- muted: oklch(0.25 0.015 160)
- muted-foreground: oklch(0.65 0.02 160)
- accent: oklch(0.25 0.015 160)
- accent-foreground: oklch(0.95 0.005 160)
- destructive: oklch(0.704 0.191 22.216)
- border: oklch(1 0 0 / 10%)
- input: oklch(1 0 0 / 12%)
- ring: oklch(0.65 0.15 175)
- chart-1: oklch(0.65 0.15 175)
- chart-2: oklch(0.696 0.17 162.48)
- chart-3: oklch(0.769 0.188 70.08)
- chart-4: oklch(0.627 0.265 303.9)
- chart-5: oklch(0.645 0.246 16.439)
- sidebar: oklch(0.21 0.012 160)
- sidebar-foreground: oklch(0.95 0.005 160)
- sidebar-primary: oklch(0.65 0.15 175)
- sidebar-primary-foreground: oklch(0.98 0 0)
- sidebar-accent: oklch(0.25 0.015 160)
- sidebar-accent-foreground: oklch(0.95 0.005 160)
- sidebar-border: oklch(1 0 0 / 10%)
- sidebar-ring: oklch(0.65 0.15 175)
- app-bg: oklch(0.17 0.01 160)
- app-sidebar: oklch(0.21 0.012 160)
- app-sidebar-hover: oklch(0.26 0.015 160)
- scrollbar-thumb: oklch(0.48 0.05 175)
- scrollbar-thumb-hover: oklch(0.58 0.07 175)
- scrollbar-track: oklch(0.23 0.012 160)
- table-header-bg: oklch(0.21 0.012 160)
- table-row-hover: oklch(0.25 0.015 160)
- table-border: oklch(1 0 0 / 10%)

**Carbon theme** `[data-theme="carbon"]` - True black OLED, brutalist/minimal:
- background: oklch(0 0 0) -- true #000000
- foreground: oklch(0.97 0 0) -- near-white (NOT pure white, to reduce halation)
- primary: oklch(0.72 0.20 300) -- bright purple accent
- primary-foreground: oklch(0.98 0 0)
- card: oklch(0.09 0 0) -- subtle lift from black
- card-foreground: oklch(0.97 0 0)
- popover: oklch(0.09 0 0)
- popover-foreground: oklch(0.97 0 0)
- secondary: oklch(0.14 0 0)
- secondary-foreground: oklch(0.97 0 0)
- muted: oklch(0.14 0 0)
- muted-foreground: oklch(0.60 0 0)
- accent: oklch(0.14 0 0)
- accent-foreground: oklch(0.97 0 0)
- destructive: oklch(0.704 0.191 22.216)
- border: oklch(1 0 0 / 8%)
- input: oklch(1 0 0 / 12%)
- ring: oklch(0.72 0.20 300)
- chart-1: oklch(0.72 0.20 300)
- chart-2: oklch(0.696 0.17 162.48)
- chart-3: oklch(0.769 0.188 70.08)
- chart-4: oklch(0.627 0.265 303.9)
- chart-5: oklch(0.645 0.246 16.439)
- sidebar: oklch(0.09 0 0)
- sidebar-foreground: oklch(0.97 0 0)
- sidebar-primary: oklch(0.72 0.20 300)
- sidebar-primary-foreground: oklch(0.98 0 0)
- sidebar-accent: oklch(0.14 0 0)
- sidebar-accent-foreground: oklch(0.97 0 0)
- sidebar-border: oklch(1 0 0 / 8%)
- sidebar-ring: oklch(0.72 0.20 300)
- app-bg: oklch(0 0 0)
- app-sidebar: oklch(0.09 0 0)
- app-sidebar-hover: oklch(0.14 0 0)
- scrollbar-thumb: oklch(0.45 0 0)
- scrollbar-thumb-hover: oklch(0.55 0 0)
- scrollbar-track: oklch(0.12 0 0)
- table-header-bg: oklch(0.09 0 0)
- table-row-hover: oklch(0.12 0 0)
- table-border: oklch(1 0 0 / 8%)

**3. Add global utility styles at the end of the `@layer base` section (the one that has `*` and `body` rules):**

```css
  /* SWITCH-05: Native form control accent theming */
  :root {
    accent-color: var(--primary);
  }

  /* SWITCH-03: Selection highlight matches theme accent */
  ::selection {
    background-color: oklch(from var(--primary) l c h / 40%);
    color: var(--foreground);
  }
```

**4. Add View Transition animation CSS AFTER the scrollbar styles section (at the very end of the file):**

```css
/* ============================================
   View Transitions API: Smooth theme switching
   SWITCH-02: 250ms cross-fade animation
   ============================================ */

::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 250ms;
  animation-timing-function: ease-in-out;
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0ms;
  }
}
```

**Important notes:**
- Keep the existing `:root` and `[data-theme="dark"]` blocks EXACTLY as they are. They serve as fallback/backward-compatible defaults.
- All 4 new theme blocks go inside the SAME `@layer base` section as the existing `:root` and `[data-theme="dark"]`.
- Use `oklch()` for all color values (consistent with Phase 22).
- For `::selection`, use `oklch(from var(--primary) l c h / 40%)` for the background (relative color syntax for 40% opacity) so it works across all themes. If the browser doesn't support relative color syntax, fall back to `var(--primary)` at reduced opacity using a standard approach.
  </action>
  <verify>
1. Visually inspect globals.css to confirm 4 new `[data-theme="..."]` blocks exist
2. Confirm the `@custom-variant dark` line includes midnight, slate, carbon
3. Confirm `::selection` and `accent-color` rules exist
4. Confirm view transition CSS exists at end of file
5. Run `npx next build` from apps/web to verify no CSS syntax errors (or just `npx next lint`)
  </verify>
  <done>
globals.css contains 4 theme variable blocks (midnight, dawn, slate, carbon) with complete token sets, ::selection styling, accent-color, and view transition animation CSS. No existing styles broken.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create theme metadata module and view transition utility</name>
  <files>apps/web/src/lib/themes.ts, apps/web/src/lib/view-transitions.ts</files>
  <action>
**Create `apps/web/src/lib/themes.ts`:**

Define and export theme metadata used by the picker UI. Each theme needs hardcoded preview colors (NOT CSS variables, because preview cards render inline styles showing theme colors regardless of current active theme).

```typescript
export interface ThemeConfig {
  name: string
  value: string
  label: string
  description: string
  accentLabel: string
  isDark: boolean
  preview: {
    bg: string
    sidebar: string
    text: string
    accent: string
  }
}

export const THEMES: ThemeConfig[] = [
  {
    name: "system",
    value: "system",
    label: "System",
    description: "Match your OS preference",
    accentLabel: "Auto",
    isDark: false, // not relevant for system
    preview: {
      // System preview shows a split light/dark card -- handled by UI component
      bg: "#1a1a2e",
      sidebar: "#222240",
      text: "#e8e8f0",
      accent: "#7c7cf0",
    },
  },
  {
    name: "midnight",
    value: "midnight",
    label: "Midnight",
    description: "Blue-undertone dark",
    accentLabel: "Blue",
    isDark: true,
    preview: {
      bg: "#141825",
      sidebar: "#1a2030",
      text: "#e8ecf4",
      accent: "#5b8af0",
    },
  },
  {
    name: "dawn",
    value: "dawn",
    label: "Dawn",
    description: "Clean light mode",
    accentLabel: "Indigo",
    isDark: false,
    preview: {
      bg: "#f7f7fa",
      sidebar: "#ededf2",
      text: "#1a1a2e",
      accent: "#5046e5",
    },
  },
  {
    name: "slate",
    value: "slate",
    label: "Slate",
    description: "Warm gray-green dark",
    accentLabel: "Teal",
    isDark: true,
    preview: {
      bg: "#1e2a28",
      sidebar: "#263432",
      text: "#e0ebe8",
      accent: "#4db8a0",
    },
  },
  {
    name: "carbon",
    value: "carbon",
    label: "Carbon",
    description: "True black OLED",
    accentLabel: "Purple",
    isDark: true,
    preview: {
      bg: "#000000",
      sidebar: "#141414",
      text: "#e8e8e8",
      accent: "#b07cf0",
    },
  },
]

export function getThemeConfig(theme: string): ThemeConfig | undefined {
  return THEMES.find((t) => t.value === theme)
}

/** Named themes only (excludes "system") */
export const NAMED_THEMES = THEMES.filter((t) => t.value !== "system")
```

Preview colors are hex approximations of the oklch values in globals.css -- they're used for inline styles in the preview cards so each card always shows its own theme's colors regardless of the currently active theme.

**Create `apps/web/src/lib/view-transitions.ts`:**

```typescript
import { flushSync } from "react-dom"

/**
 * Wraps a callback in the View Transitions API for smooth visual transitions.
 * Falls back to immediate execution on unsupported browsers (progressive enhancement).
 *
 * Usage: withViewTransition(() => setTheme("midnight"))
 */
export function withViewTransition(callback: () => void): void {
  // Progressive enhancement: instant change if View Transitions API not supported
  if (
    typeof document === "undefined" ||
    !("startViewTransition" in document)
  ) {
    callback()
    return
  }

  // Wrap in view transition for smooth cross-fade
  document.startViewTransition(() => {
    // flushSync ensures React commits DOM changes synchronously
    // so the View Transitions API can snapshot the new state
    flushSync(callback)
  })
}
```

Both files should be clean TypeScript with no external dependencies beyond React's flushSync.
  </action>
  <verify>
1. Confirm both files exist and export correctly: `THEMES`, `ThemeConfig`, `getThemeConfig`, `NAMED_THEMES` from themes.ts; `withViewTransition` from view-transitions.ts
2. TypeScript compilation check: `npx tsc --noEmit` from apps/web (or rely on next build)
3. Confirm THEMES array has exactly 5 entries (system + 4 named themes)
  </verify>
  <done>
lib/themes.ts exports theme metadata array with 5 entries (system + 4 named themes), each with preview colors. lib/view-transitions.ts exports withViewTransition utility with progressive enhancement fallback.
  </done>
</task>

</tasks>

<verification>
1. globals.css has 6 theme blocks total: :root, dark, midnight, dawn, slate, carbon
2. Each theme block has all shadcn tokens + app semantic tokens (no missing variables)
3. ::selection and accent-color rules present in @layer base
4. View transition CSS present at end of file
5. lib/themes.ts and lib/view-transitions.ts are valid TypeScript
6. No existing styles or functionality broken
</verification>

<success_criteria>
- 4 distinct theme CSS variable sets defined with unique accent colors per theme
- Theme metadata module provides typed configuration for UI components
- View transition utility ready for use by theme picker
- All existing :root and dark theme styles unchanged
- SWITCH-03 (::selection), SWITCH-05 (accent-color), SWITCH-02 CSS (view transition animation) implemented
</success_criteria>

<output>
After completion, create `.planning/phases/23-theme-presets-switching/23-01-SUMMARY.md`
</output>
