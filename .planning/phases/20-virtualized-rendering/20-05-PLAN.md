---
phase: 20-virtualized-rendering
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/bookkeeping/record-row.tsx
  - apps/web/src/components/bookkeeping/quick-filter-chips.tsx
  - apps/web/src/components/bookkeeping/bookkeeping-content.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Clicking anywhere on a row expands/collapses it"
    - "Return Label and Return Closed appear as separate filter chips"
    - "Each return filter chip filters to its specific status"
  artifacts:
    - path: "apps/web/src/components/bookkeeping/record-row.tsx"
      provides: "Row container with onClick handler"
      contains: "onClick.*onToggleExpand"
    - path: "apps/web/src/components/bookkeeping/quick-filter-chips.tsx"
      provides: "Separate return filter chips"
      contains: "return_label|return_closed"
    - path: "apps/web/src/components/bookkeeping/bookkeeping-content.tsx"
      provides: "Filter logic for separate return statuses"
      contains: "return_label|return_closed"
  key_links:
    - from: "record-row.tsx"
      to: "onToggleExpand"
      via: "onClick on row container"
      pattern: "onClick.*onToggleExpand"
    - from: "quick-filter-chips.tsx"
      to: "bookkeeping-content.tsx"
      via: "filter id matching"
      pattern: "return_label|return_closed"
---

<objective>
Fix two minor UAT issues from Phase 20 user acceptance testing.

Purpose: Close remaining UX gaps identified during manual testing - row click expansion and granular return filter chips.
Output: Updated record-row.tsx with row click handler, updated quick-filter-chips.tsx with separate return filters, updated bookkeeping-content.tsx with corresponding filter logic.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-virtualized-rendering/20-virtualized-rendering-UAT.md
@apps/web/src/components/bookkeeping/record-row.tsx
@apps/web/src/components/bookkeeping/quick-filter-chips.tsx
@apps/web/src/components/bookkeeping/bookkeeping-content.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add onClick handler to row container</name>
  <files>apps/web/src/components/bookkeeping/record-row.tsx</files>
  <action>
Add onClick handler to the main row container div (around line 354-363) that calls onToggleExpand(record.id).

The row container div currently has no onClick - only the expand button has one. Add:
- onClick={() => onToggleExpand(record.id)} to the main div
- cursor-pointer class for visual affordance
- Ensure the click doesn't interfere with interactive elements inside the row (the Select dropdown and delete Button already have their own click handlers that will stop propagation)

Do NOT add onClick to the expanded details row (the row.type === "expanded" case around line 216) - that should remain non-clickable.
  </action>
  <verify>
Manually verify in browser: clicking anywhere on a record row (not just the arrow) toggles expansion. Clicking the status dropdown or delete button should still work independently.
  </verify>
  <done>Row container div has onClick that calls onToggleExpand, clicking row body expands/collapses details.</done>
</task>

<task type="auto">
  <name>Task 2: Split Returns filter into separate chips</name>
  <files>apps/web/src/components/bookkeeping/quick-filter-chips.tsx, apps/web/src/components/bookkeeping/bookkeeping-content.tsx</files>
  <action>
In quick-filter-chips.tsx, update QUICK_FILTERS array (lines 6-15):

Replace the combined "Returns" filter:
```typescript
{
  id: "returns",
  label: "Returns",
  statuses: ["RETURN_LABEL_PROVIDED", "RETURN_CLOSED"],
}
```

With two separate filters:
```typescript
{ id: "return_label", label: "Return Label", status: "RETURN_LABEL_PROVIDED" },
{ id: "return_closed", label: "Return Closed", status: "RETURN_CLOSED" },
```

In bookkeeping-content.tsx, update the filteredRecords useMemo (around lines 170-186):

Replace:
```typescript
if (activeFilter === "returns") {
  return records.filter(
    (record) =>
      record.status === "RETURN_LABEL_PROVIDED" ||
      record.status === "RETURN_CLOSED"
  );
}
```

With two separate cases:
```typescript
if (activeFilter === "return_label") {
  return records.filter((record) => record.status === "RETURN_LABEL_PROVIDED");
}
if (activeFilter === "return_closed") {
  return records.filter((record) => record.status === "RETURN_CLOSED");
}
```
  </action>
  <verify>
Run `npm run build --prefix apps/web` to verify no TypeScript errors.
Manually verify in browser: "Return Label" and "Return Closed" appear as separate filter chips. Clicking each filters to only that status.
  </verify>
  <done>"Return Label" and "Return Closed" are separate clickable filter chips, each filtering to its specific status.</done>
</task>

</tasks>

<verification>
1. `npm run build --prefix apps/web` passes without errors
2. Row click expansion works - clicking anywhere on row toggles expand (not just arrow)
3. Filter chips show: All, Successful, Return Label, Return Closed, Refunds (5 chips)
4. Each filter chip filters correctly to its status
</verification>

<success_criteria>
- Clicking a row body (not just the arrow) expands/collapses the row
- "Return Label" chip filters to RETURN_LABEL_PROVIDED records only
- "Return Closed" chip filters to RETURN_CLOSED records only
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/20-virtualized-rendering/20-05-SUMMARY.md`
</output>
