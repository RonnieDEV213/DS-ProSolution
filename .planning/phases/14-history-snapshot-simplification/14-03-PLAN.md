---
phase: 14-history-snapshot-simplification
plan: 03
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - apps/web/src/app/admin/automation/page.tsx
  - apps/web/src/components/admin/collection/diff-modal.tsx
  - apps/web/src/components/admin/collection/hierarchical-run-modal.tsx
  - apps/api/src/app/routers/sellers.py
  - apps/api/src/app/routers/collection.py
  - apps/api/src/app/models.py
autonomous: true

must_haves:
  truths:
    - "DiffModal component file deleted"
    - "HierarchicalRunModal component file deleted"
    - "POST /sellers/diff endpoint removed"
    - "GET /collection/runs/{run_id}/breakdown endpoint removed"
    - "automation/page.tsx has no imports of deleted components"
  artifacts:
    - path: "apps/web/src/app/admin/automation/page.tsx"
      provides: "Cleaned page without deleted modal imports"
      min_lines: 100
  key_links: []
---

<objective>
Delete unused components and endpoints after modal unification

Purpose: Remove dead code that was replaced by the unified History Entry modal
Output: Clean codebase without DiffModal, HierarchicalRunModal, /sellers/diff, and /collection/runs/{run_id}/breakdown
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-history-snapshot-simplification/14-CONTEXT.md
@.planning/phases/14-history-snapshot-simplification/14-RESEARCH.md
@apps/web/src/app/admin/automation/page.tsx
@apps/web/src/components/admin/collection/diff-modal.tsx
@apps/web/src/components/admin/collection/hierarchical-run-modal.tsx
@apps/api/src/app/routers/sellers.py
@apps/api/src/app/routers/collection.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete frontend components</name>
  <files>
    apps/web/src/components/admin/collection/diff-modal.tsx
    apps/web/src/components/admin/collection/hierarchical-run-modal.tsx
  </files>
  <action>
Delete the following component files:

1. Delete: `apps/web/src/components/admin/collection/diff-modal.tsx`
2. Delete: `apps/web/src/components/admin/collection/hierarchical-run-modal.tsx`

These components are fully replaced by the unified History Entry modal.
  </action>
  <verify>
Files deleted:
- `test ! -f apps/web/src/components/admin/collection/diff-modal.tsx && echo "deleted"`
- `test ! -f apps/web/src/components/admin/collection/hierarchical-run-modal.tsx && echo "deleted"`
  </verify>
  <done>diff-modal.tsx and hierarchical-run-modal.tsx files deleted</done>
</task>

<task type="auto">
  <name>Task 2: Clean up automation page imports and state</name>
  <files>apps/web/src/app/admin/automation/page.tsx</files>
  <action>
Remove all references to deleted components from the automation page.

1. **Remove imports:**
```diff
- import { HierarchicalRunModal } from "@/components/admin/collection/hierarchical-run-modal";
- import { DiffModal } from "@/components/admin/collection/diff-modal";
```

2. **Remove state variables:**
```diff
- const [diffModalOpen, setDiffModalOpen] = useState(false);
- const [diffSourceId, setDiffSourceId] = useState<string | null>(null);
- const [diffTargetId, setDiffTargetId] = useState<string | null>(null);
- const [hierarchicalRunOpen, setHierarchicalRunOpen] = useState(false);
```

3. **Remove handler functions:**
```diff
- const handleCompare = (sourceId: string | null, targetId: string | null) => {
-   setDiffSourceId(sourceId);
-   setDiffTargetId(targetId);
-   setLogDetailOpen(false);
-   setDiffModalOpen(true);
- };
```

4. **Remove component JSX:**
```diff
- <DiffModal
-   open={diffModalOpen}
-   onOpenChange={setDiffModalOpen}
-   sourceId={diffSourceId}
-   targetId={diffTargetId}
- />

- <HierarchicalRunModal
-   open={hierarchicalRunOpen}
-   onOpenChange={setHierarchicalRunOpen}
-   runId={selectedRunId}
-   onRerun={(categoryIds) => {
-     setPreselectedCategories(categoryIds);
-     setRunConfigOpen(true);
-   }}
- />
```

5. **Update LogDetailModal props:**
```diff
<LogDetailModal
  open={logDetailOpen}
  onOpenChange={(open) => {
    setLogDetailOpen(open);
    if (!open) {
      setSelectedLogId(null);
      setSelectedRunId(null);
    }
  }}
  selectedLogId={selectedLogId}
  selectedRunId={selectedRunId}
-  onCompare={handleCompare}
-  onCollectionRunDetail={(runId) => {
-    setLogDetailOpen(false);
-    setSelectedRunId(runId);
-    setHierarchicalRunOpen(true);
-  }}
/>
```

6. **Simplify collection run click handler in HistoryPanel:**
   - Keep the current behavior: clicking opens LogDetailModal with runId
   - Remove the comment about "not HierarchicalRunModal" (no longer relevant)
  </action>
  <verify>
Check imports removed:
- `grep "HierarchicalRunModal" apps/web/src/app/admin/automation/page.tsx` returns nothing
- `grep "DiffModal" apps/web/src/app/admin/automation/page.tsx` returns nothing
- `grep "diffModalOpen" apps/web/src/app/admin/automation/page.tsx` returns nothing
  </verify>
  <done>automation/page.tsx cleaned of all deleted component references</done>
</task>

<task type="auto">
  <name>Task 3: Remove backend endpoints</name>
  <files>apps/api/src/app/routers/sellers.py, apps/api/src/app/routers/collection.py, apps/api/src/app/models.py</files>
  <action>
Remove unused backend endpoints.

1. **In sellers.py, delete the POST /sellers/diff endpoint (lines ~313-356):**
   - Delete the entire `@router.post("/diff")` function
   - Delete the `calculate_diff` function call

2. **In collection.py, delete the GET /runs/{run_id}/breakdown endpoint (lines ~266-318):**
   - Delete the entire `@router.get("/runs/{run_id}/breakdown")` function

3. **In models.py, remove unused models:**
   - Delete `DiffRequest` model (used by /diff endpoint)
   - Delete `SellerDiff` model (used by /diff endpoint)
   - Keep other models that may still be in use

4. **In sellers.py, clean up imports:**
   - Remove `DiffRequest` and `SellerDiff` from imports if no longer used

Note: Keep the `calculate_diff` method in CollectionService if it's used elsewhere (check first), or remove it if it's only used by the deleted endpoint.
  </action>
  <verify>
Check endpoints removed:
- `grep -n "post.*diff" apps/api/src/app/routers/sellers.py` returns nothing
- `grep -n "breakdown" apps/api/src/app/routers/collection.py` returns nothing

Check models removed:
- `grep "class DiffRequest" apps/api/src/app/models.py` returns nothing (if removed)

API still runs:
- `cd apps/api && python -c "from app.main import app; print('OK')"`
  </verify>
  <done>POST /sellers/diff and GET /collection/runs/{run_id}/breakdown endpoints removed, unused models deleted</done>
</task>

</tasks>

<verification>
1. Frontend builds: `cd apps/web && npm run build 2>&1 | head -20`
2. Backend runs: `cd apps/api && python -c "from app.main import app; print('OK')"`
3. Files deleted: `ls apps/web/src/components/admin/collection/ | grep -E "diff-modal|hierarchical-run"` returns nothing
4. No dangling imports: `grep -r "DiffModal\|HierarchicalRunModal" apps/web/src/` returns nothing in source files
</verification>

<success_criteria>
- [ ] diff-modal.tsx deleted
- [ ] hierarchical-run-modal.tsx deleted
- [ ] POST /sellers/diff endpoint removed
- [ ] GET /collection/runs/{run_id}/breakdown endpoint removed
- [ ] automation/page.tsx has no references to deleted components
- [ ] Frontend builds without errors
- [ ] Backend runs without import errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-history-snapshot-simplification/14-03-SUMMARY.md`
</output>
