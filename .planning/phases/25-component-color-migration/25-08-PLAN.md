---
phase: 25-component-color-migration
plan: 08
type: execute
wave: 3
depends_on: ["25-07"]
files_modified:
  - apps/web/src/lib/api.ts
  - apps/web/src/components/bookkeeping/record-row.tsx
  - apps/web/src/components/bookkeeping/records-table.tsx
  - apps/web/src/components/bookkeeping/virtualized-records-list.tsx
  - apps/web/src/components/admin/collection/log-detail-modal.tsx
  - apps/web/src/components/admin/collection/pipeline-feed.tsx
  - apps/web/src/components/admin/collection/run-config-modal.tsx
  - apps/web/src/components/admin/collection/progress-detail-modal.tsx
  - apps/web/src/components/admin/collection/worker-detail-view.tsx
  - apps/web/src/components/admin/collection/history-panel.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Bookkeeping status column shows readable check icon, full status labels without clipping, and simplified 'Refund' label"
    - "COGS values display with monospace pill background matching Earnings and Profit"
    - "Order tracking scrollable containers use themed thin scrollbars, not browser defaults"
    - "Collection area scrollable containers use themed thin scrollbars, not browser defaults"
    - "Collection history quick view entries are compact with reduced spacing and condensed data"
  artifacts:
    - path: "apps/web/src/lib/api.ts"
      provides: "STATUS_LABELS with simplified Refund label"
      contains: "REFUND_NO_RETURN: \"Refund\""
    - path: "apps/web/src/components/bookkeeping/record-row.tsx"
      provides: "Larger status icons, wider status column, pill on COGS, simplified refund label"
      contains: "w-4 h-4"
    - path: "apps/web/src/components/bookkeeping/records-table.tsx"
      provides: "Pill on COGS, simplified refund label, wider status trigger"
      contains: "bg-primary/10"
    - path: "apps/web/src/components/bookkeeping/virtualized-records-list.tsx"
      provides: "scrollbar-thin on outer container"
      contains: "scrollbar-thin"
    - path: "apps/web/src/components/admin/collection/log-detail-modal.tsx"
      provides: "scrollbar-thin on both overflow containers"
      contains: "scrollbar-thin"
    - path: "apps/web/src/components/admin/collection/history-panel.tsx"
      provides: "Compact spacing on quick view entries"
      contains: "space-y-1"
  key_links:
    - from: "apps/web/src/lib/api.ts"
      to: "records-table.tsx STATUS_LABELS usage"
      via: "STATUS_LABELS import"
      pattern: "STATUS_LABELS\\[displayStatus\\]"
    - from: "record-row.tsx STATUS_OPTIONS"
      to: "SelectItem rendering"
      via: "STATUS_OPTIONS.map"
      pattern: "STATUS_OPTIONS"
---

<objective>
Close 5 UAT gaps from Phase 25 verification. All are small CSS class and text fixes across bookkeeping and collection components.

Purpose: Resolve all remaining visual polish issues identified during user acceptance testing of the component color migration.
Output: All 5 UAT gaps closed -- status column readable, COGS pill styled, all scrollbars themed, history panel compact.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-component-color-migration/25-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix bookkeeping status column, COGS pill, and order tracking scrollbars</name>
  <files>
    apps/web/src/lib/api.ts
    apps/web/src/components/bookkeeping/record-row.tsx
    apps/web/src/components/bookkeeping/records-table.tsx
    apps/web/src/components/bookkeeping/virtualized-records-list.tsx
  </files>
  <action>
    **Gap 1 -- Status column readability (3 sub-fixes):**

    1. In `apps/web/src/lib/api.ts` line 29, change the REFUND_NO_RETURN label:
       - FROM: `REFUND_NO_RETURN: "Refund (No Return)"`
       - TO: `REFUND_NO_RETURN: "Refund"`

    2. In `apps/web/src/components/bookkeeping/record-row.tsx`:
       - Line 38: Change STATUS_OPTIONS label from `"Refund (No Return)"` to `"Refund"`
       - Lines 44-51: Change ALL status icon sizes from `w-3 h-3` to `w-4 h-4` (4 icons: Check, RotateCcw, X, PackageX)
       - Line 459: Change status column width from `w-40` to `w-48`

    3. In `apps/web/src/components/bookkeeping/records-table.tsx`:
       - Line 59: Change STATUS_OPTIONS label from `"Refund (No Return)"` to `"Refund"`
       - Lines 66-69: Change ALL status icon sizes from `w-3 h-3` to `w-4 h-4` (4 icons)
       - Line 530: Change SelectTrigger from `min-w-[160px]` to `min-w-[192px]` (matches w-48 = 192px)

    **Gap 2 -- COGS pill background (2 fixes):**

    4. In `apps/web/src/components/bookkeeping/record-row.tsx` line 435:
       - FROM: `<span className="font-mono text-sm">`
       - TO: `<span className="font-mono text-sm px-1.5 py-0.5 rounded bg-primary/10">`

    5. In `apps/web/src/components/bookkeeping/records-table.tsx` line 488:
       - FROM: `<span className="font-mono text-sm">`
       - TO: `<span className="font-mono text-sm px-1.5 py-0.5 rounded bg-primary/10">`

    **Gap 3 -- Order tracking scrollbars (2 fixes):**

    6. In `apps/web/src/components/bookkeeping/virtualized-records-list.tsx` line 397:
       - FROM: `className="rounded-md border border-border overflow-x-auto focus:outline-none"`
       - TO: `className="rounded-md border border-border overflow-x-auto scrollbar-thin focus:outline-none"`

    7. In `apps/web/src/components/bookkeeping/records-table.tsx` line 365:
       - FROM: `className="rounded-md border border-border overflow-x-auto"`
       - TO: `className="rounded-md border border-border overflow-x-auto scrollbar-thin"`

    Also check virtualized-records-list.tsx line 413 (the w-40 status header): change to `w-48` to match the row column width change.
  </action>
  <verify>
    Run `npx tsc --noEmit` from apps/web to confirm no type errors.
    Grep for "Refund (No Return)" across all files -- should return zero matches in component/lib files.
    Grep for "w-3 h-3" in record-row.tsx and records-table.tsx STATUS_ICONS -- should return zero matches.
    Grep for COGS spans to confirm they now have bg-primary/10.
    Grep for scrollbar-thin in virtualized-records-list.tsx and records-table.tsx -- should find matches.
  </verify>
  <done>
    - STATUS_LABELS and STATUS_OPTIONS show "Refund" (not "Refund (No Return)") in all 3 locations
    - All 8 status icons (4 per file) use w-4 h-4
    - Status column is w-48 in record-row.tsx, min-w-[192px] in records-table.tsx, w-48 in virtualized header
    - COGS spans in both files have px-1.5 py-0.5 rounded bg-primary/10
    - scrollbar-thin added to overflow containers in virtualized-records-list.tsx and records-table.tsx
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix collection scrollbars and history panel spacing</name>
  <files>
    apps/web/src/components/admin/collection/log-detail-modal.tsx
    apps/web/src/components/admin/collection/pipeline-feed.tsx
    apps/web/src/components/admin/collection/run-config-modal.tsx
    apps/web/src/components/admin/collection/progress-detail-modal.tsx
    apps/web/src/components/admin/collection/worker-detail-view.tsx
    apps/web/src/components/admin/collection/history-panel.tsx
  </files>
  <action>
    **Gap 4 -- Collection scrollbars (add scrollbar-thin to 7 containers across 5 files):**

    These containers have `overflow-y-auto` but are missing `scrollbar-thin`:

    1. `log-detail-modal.tsx` line 276:
       - FROM: `className="flex-1 overflow-y-auto bg-muted rounded border border-border p-2 min-h-0"`
       - TO: `className="flex-1 overflow-y-auto scrollbar-thin bg-muted rounded border border-border p-2 min-h-0"`

    2. `log-detail-modal.tsx` line 343:
       - FROM: `className="flex-1 overflow-y-auto bg-muted rounded border border-border min-h-0"`
       - TO: `className="flex-1 overflow-y-auto scrollbar-thin bg-muted rounded border border-border min-h-0"`

    3. `pipeline-feed.tsx` line 124:
       - FROM: `className="space-y-1.5 h-full overflow-y-auto pr-1"`
       - TO: `className="space-y-1.5 h-full overflow-y-auto scrollbar-thin pr-1"`

    4. `run-config-modal.tsx` line 271:
       - FROM: `className="overflow-y-auto pr-2 min-h-0"`
       - TO: `className="overflow-y-auto scrollbar-thin pr-2 min-h-0"`

    5. `run-config-modal.tsx` line 279:
       - FROM: `className="border-l border-border pl-4 space-y-4 overflow-y-auto min-h-0"`
       - TO: `className="border-l border-border pl-4 space-y-4 overflow-y-auto scrollbar-thin min-h-0"`

    6. `progress-detail-modal.tsx` line 377:
       - FROM: `className="overflow-y-auto"`
       - TO: `className="overflow-y-auto scrollbar-thin"`

    7. `worker-detail-view.tsx` line 184:
       - FROM: `className="flex-1 overflow-y-auto space-y-1 pr-2"`
       - TO: `className="flex-1 overflow-y-auto scrollbar-thin space-y-1 pr-2"`

    **Gap 5 -- History panel spacing and data density (history-panel.tsx):**

    8. Line 228: Change `space-y-2` to `space-y-1` on the history entries container.

    9. Lines 155-190 (renderCollectionRun): Condense the collection run entry:
       - Line 159: Change `py-2` to `py-1.5` on the button
       - Lines 170-189: Combine the second row into a single line. Replace the current two-row layout with a single compact row:
         - Remove the outer `<div className="flex items-center justify-between mt-1">` wrapper
         - Replace with: `<div className="flex items-center gap-1.5 mt-0.5 text-muted-foreground text-xs">`
         - Show only: timestamp (font-mono), and if sellers_new > 0 show "+N sellers" in green
         - Remove the categories count and seller_count_snapshot from this view (they are visible in the detail modal)

    10. Lines 193-216 (renderManualEdit): Condense the manual edit entry:
        - Line 197: Change `py-2` to `py-1.5` on the button
        - Line 210: Change `mt-1` to `mt-0.5`
        - Remove the seller_count_snapshot span (lines 212-214) -- visible in detail modal
  </action>
  <verify>
    Run `npx tsc --noEmit` from apps/web to confirm no type errors.
    Grep for `overflow-y-auto` across collection directory -- every match should also have `scrollbar-thin` on the same line (except overflow-hidden which is different).
    Grep for `space-y-2` in history-panel.tsx -- should return zero matches.
    Grep for `py-2` in history-panel.tsx entry buttons -- should return zero matches (now py-1.5).
  </verify>
  <done>
    - All 7 overflow-y-auto containers across 5 collection files have scrollbar-thin
    - History panel entries use space-y-1 gap, py-1.5 padding, mt-0.5 between rows
    - Collection run quick view shows only: name, status badge, timestamp, and +N sellers (if any)
    - Manual edit quick view shows only: icon, name/count, timestamp (no seller_count_snapshot)
    - No type errors introduced
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors from apps/web
2. `npm run build` succeeds from apps/web (or at minimum `next lint` passes)
3. Grep audit:
   - `"Refund (No Return)"` returns zero matches in src/lib/api.ts, record-row.tsx, records-table.tsx
   - `w-3 h-3` returns zero matches in STATUS_ICONS blocks
   - All `overflow-y-auto` containers in collection/ also have `scrollbar-thin`
   - COGS spans contain `bg-primary/10`
</verification>

<success_criteria>
All 5 UAT gaps closed:
1. Status column: w-4 h-4 icons, w-48 column, "Refund" label (no "(No Return)")
2. COGS pill: bg-primary/10 rounded pill matching Earnings and Profit
3. Order tracking scrollbars: scrollbar-thin on virtualized list and table containers
4. Collection scrollbars: scrollbar-thin on all 7 overflow-y-auto containers
5. History panel: compact spacing (space-y-1, py-1.5, mt-0.5) with condensed data per entry
</success_criteria>

<output>
After completion, create `.planning/phases/25-component-color-migration/25-08-SUMMARY.md`
</output>
