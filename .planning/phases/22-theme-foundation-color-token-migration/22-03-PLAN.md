---
phase: 22-theme-foundation-color-token-migration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/bookkeeping/account-selector.tsx
  - apps/web/src/components/ui/badge.tsx
  - apps/web/src/components/admin/collection/sellers-grid.tsx
  - apps/web/src/components/admin/collection/history-panel.tsx
  - apps/web/src/components/admin/collection/recent-logs-sidebar.tsx
  - apps/web/src/components/admin/collection/activity-feed.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Account selector uses semantic tokens instead of hardcoded grays"
    - "Badge outline variant uses predictable foreground color"
    - "All scrollable panels use scrollbar-thin utility without old plugin classes"
  artifacts:
    - path: "apps/web/src/components/bookkeeping/account-selector.tsx"
      provides: "Account selector with semantic tokens"
      min_lines: 45
    - path: "apps/web/src/components/ui/badge.tsx"
      provides: "Badge with border-border for outline variant"
      min_lines: 40
    - path: "apps/web/src/components/admin/collection/sellers-grid.tsx"
      provides: "Virtualized grid with clean scrollbar-thin class"
      min_lines: 1500
    - path: "apps/web/src/components/admin/collection/history-panel.tsx"
      provides: "History panel with scrollbar-thin styling"
      min_lines: 250
    - path: "apps/web/src/components/admin/collection/recent-logs-sidebar.tsx"
      provides: "Recent logs sidebar with scrollbar-thin styling"
      min_lines: 120
    - path: "apps/web/src/components/admin/collection/activity-feed.tsx"
      provides: "Activity feed with scrollbar-thin styling"
      min_lines: 340
  key_links:
    - from: "apps/web/src/components/bookkeeping/account-selector.tsx"
      to: "globals.css semantic tokens"
      via: "bg-popover, border-border classes"
      pattern: "bg-popover|border-border"
    - from: "apps/web/src/components/ui/badge.tsx"
      to: "globals.css border token"
      via: "border-border in outline variant"
      pattern: "border-border"
    - from: "apps/web/src/components/admin/collection/*.tsx"
      to: "globals.css scrollbar-thin utility"
      via: "scrollbar-thin class only"
      pattern: "scrollbar-thin(?!\\s+scrollbar-thumb-)"
---

<objective>
Fix two UAT-diagnosed gaps in Phase 22 implementation: (1) text readability regression from hardcoded colors bypassing design tokens, (2) scrollbar class migration incompleteness with old plugin classes.

Purpose: Ensure Phase 22's token system is consistently applied without regressions and scrollbar utilities use only CSS-first approach without undefined tailwind-scrollbar plugin classes.

Output: 6 component files using semantic tokens and clean scrollbar-thin utility.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@./.planning/PROJECT.md
@./.planning/ROADMAP.md
@./.planning/STATE.md
@./.planning/phases/22-theme-foundation-color-token-migration/22-01-SUMMARY.md
@./.planning/phases/22-theme-foundation-color-token-migration/22-02-SUMMARY.md
@./apps/web/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix account-selector and badge hardcoded colors</name>
  <files>
apps/web/src/components/bookkeeping/account-selector.tsx
apps/web/src/components/ui/badge.tsx
  </files>
  <action>
**account-selector.tsx (lines 31, 34, 39):**

Replace hardcoded gray classes with shadcn/ui semantic tokens:
- Line 31: `bg-gray-800 border-gray-700` → `bg-popover border-border`
- Line 34: `bg-gray-800 border-gray-700` → `bg-popover border-border`
- Line 39: `text-white hover:bg-gray-700` → Remove `text-white`, keep `hover:bg-gray-700` (hover style is intentional, text inherits from popover-foreground)

Why: hardcoded bg-gray-800/text-white bypass the design token system and cause readability issues under theme switching. bg-popover and border-border use semantic tokens defined in globals.css that respond to data-theme attribute.

**badge.tsx (line 19):**

Add border-border to outline variant:
- Line 19: `"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"` → `"border-border text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"`

Why: outline variant currently has no explicit border color, relying on default transparent from base variant. Adding border-border makes the border visible and theme-aware. This fixes UAT Test 1 where badge outline variant may not resolve text-foreground correctly under data-theme selector.
  </action>
  <verify>
Build succeeds:
```bash
cd apps/web
npm run build
```

Visual inspection:
- Account selector dropdown has themed background/border (not hardcoded gray-800)
- Badge outline variant has visible border matching theme
  </verify>
  <done>
- account-selector.tsx uses bg-popover, border-border instead of bg-gray-800, border-gray-700
- badge.tsx outline variant includes border-border
- No TypeScript errors
- Build succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove old scrollbar plugin classes and add scrollbar-thin</name>
  <files>
apps/web/src/components/admin/collection/sellers-grid.tsx
apps/web/src/components/admin/collection/history-panel.tsx
apps/web/src/components/admin/collection/recent-logs-sidebar.tsx
apps/web/src/components/admin/collection/activity-feed.tsx
  </files>
  <action>
**sellers-grid.tsx (line 1512):**

Remove old tailwind-scrollbar plugin classes that are undefined (no plugin installed):
- Current: `className="scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent"`
- Replace with: `className="scrollbar-thin"`

Why: The old plugin classes (scrollbar-thumb-*, scrollbar-track-*) are from tailwind-scrollbar plugin which is NOT installed. These classes are undefined/no-op. The new scrollbar-thin utility (from globals.css) uses CSS variables --scrollbar-thumb and --scrollbar-track which are theme-aware.

**history-panel.tsx (line 228):**

Add scrollbar-thin to scrollable container:
- Current: `className="flex-1 overflow-y-auto space-y-2 min-h-0"`
- Replace with: `className="flex-1 overflow-y-auto space-y-2 min-h-0 scrollbar-thin"`

Why: UAT Test 5 identified this as missing scrollbar styling. Adding scrollbar-thin applies the theme-aware scrollbar from globals.css.

**recent-logs-sidebar.tsx (line 91):**

Add scrollbar-thin to scrollable container:
- Current: `className="flex-1 overflow-y-auto space-y-1 min-h-0"`
- Replace with: `className="flex-1 overflow-y-auto space-y-1 min-h-0 scrollbar-thin"`

Why: UAT Test 5 identified this as missing scrollbar styling. Adding scrollbar-thin applies the theme-aware scrollbar from globals.css.

**activity-feed.tsx (line 330):**

Add scrollbar-thin to scrollable container:
- Current: `className="space-y-2 max-h-[400px] overflow-y-auto pr-2"`
- Replace with: `className="space-y-2 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin"`

Why: UAT Test 5 identified this as missing scrollbar styling. Adding scrollbar-thin applies the theme-aware scrollbar from globals.css.

**Context:** The scrollbar-thin utility is defined in globals.css (lines 185-226) using CSS-first approach:
- scrollbar-color (standards-first)
- scrollbar-width: thin
- webkit fallback with ::-webkit-scrollbar
- Uses CSS variables --scrollbar-thumb, --scrollbar-thumb-hover, --scrollbar-track which are theme-aware

Do NOT install tailwind-scrollbar plugin -- Phase 22 established CSS-only approach.
  </action>
  <verify>
Build succeeds:
```bash
cd apps/web
npm run build
```

Grep verification:
```bash
cd apps/web
# Should find NO matches (old plugin classes removed)
grep -n "scrollbar-thumb-gray-700\|scrollbar-track-transparent" src/components/admin/collection/sellers-grid.tsx

# Should find scrollbar-thin in all 4 files
grep -n "scrollbar-thin" src/components/admin/collection/sellers-grid.tsx
grep -n "scrollbar-thin" src/components/admin/collection/history-panel.tsx
grep -n "scrollbar-thin" src/components/admin/collection/recent-logs-sidebar.tsx
grep -n "scrollbar-thin" src/components/admin/collection/activity-feed.tsx
```

Visual inspection:
- Scrollable areas have themed scrollbars (not default browser scrollbars)
- Scrollbar color matches theme (light vs dark)
  </verify>
  <done>
- sellers-grid.tsx uses only scrollbar-thin (no plugin classes)
- history-panel.tsx, recent-logs-sidebar.tsx, activity-feed.tsx have scrollbar-thin added
- No references to scrollbar-thumb-gray-700 or scrollbar-track-transparent remain
- Build succeeds
- Scrollbars are theme-aware via CSS variables
  </done>
</task>

</tasks>

<verification>
**UAT Gap 1 (Text readability) - CLOSED:**
- account-selector.tsx uses bg-popover/border-border (semantic tokens)
- badge.tsx outline variant has border-border for visible themed border
- No hardcoded bg-gray-800/border-gray-700/text-white bypassing tokens

**UAT Gap 2 (Scrollbar migration) - CLOSED:**
- sellers-grid.tsx uses clean scrollbar-thin (no old plugin classes)
- 3 panels (history-panel, recent-logs-sidebar, activity-feed) have scrollbar-thin added
- All scrollbars use CSS-first approach from globals.css with theme-aware CSS variables

**Build verification:**
```bash
cd apps/web
npm run build
```
Must succeed with no TypeScript errors.

**Grep verification:**
```bash
cd apps/web
# Should return 0 matches
grep -r "scrollbar-thumb-gray-700\|scrollbar-track-transparent" src/components/admin/collection/

# Should find scrollbar-thin in all 4 files
grep -l "scrollbar-thin" src/components/admin/collection/{sellers-grid,history-panel,recent-logs-sidebar,activity-feed}.tsx | wc -l
# Expected: 4
```
</verification>

<success_criteria>
- [ ] account-selector.tsx uses bg-popover, border-border (no bg-gray-800, border-gray-700, text-white)
- [ ] badge.tsx outline variant includes border-border
- [ ] sellers-grid.tsx uses scrollbar-thin only (no scrollbar-thumb-gray-700, scrollbar-track-transparent)
- [ ] history-panel.tsx has scrollbar-thin on line 228 container
- [ ] recent-logs-sidebar.tsx has scrollbar-thin on line 91 container
- [ ] activity-feed.tsx has scrollbar-thin on line 330 container
- [ ] Build succeeds with no errors
- [ ] No old plugin classes remain (grep verification)
- [ ] All scrollbars use theme-aware CSS variables from globals.css
</success_criteria>

<output>
After completion, create `.planning/phases/22-theme-foundation-color-token-migration/22-03-SUMMARY.md`
</output>
