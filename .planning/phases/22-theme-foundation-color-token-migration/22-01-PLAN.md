---
phase: 22-theme-foundation-color-token-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "All hardcoded gray hex values in globals.css are replaced with CSS variable references"
    - "Dark theme values are scoped under [data-theme='dark'] selector instead of .dark class"
    - "@custom-variant dark uses data-theme attribute selector pattern"
    - "Application-level semantic tokens (--app-bg, --app-sidebar, --scrollbar-*, --table-*) are defined in @theme inline and have values in both :root and [data-theme='dark']"
    - "Scrollbar styles use CSS variable colors with standards-first approach (scrollbar-color/scrollbar-width) and webkit progressive enhancement"
    - "scrollbar-gutter: stable is applied to scrollable containers"
    - "Type scale CSS variables exist for 6 sizes with semantic aliases"
    - "Font weight conventions are defined as CSS variables"
  artifacts:
    - path: "apps/web/src/app/globals.css"
      provides: "Complete semantic token system, scrollbar styles, type scale"
      contains: "@theme inline.*--color-app-bg"
  key_links:
    - from: "apps/web/src/app/globals.css @theme inline"
      to: "apps/web/src/app/globals.css @layer base"
      via: "CSS variable references (--color-app-bg references --app-bg defined in :root)"
      pattern: "--color-app-bg.*var\\(--app-bg\\)"
    - from: "apps/web/src/app/globals.css .scrollbar-thin"
      to: "apps/web/src/app/globals.css :root"
      via: "scrollbar-color references --scrollbar-thumb and --scrollbar-track variables"
      pattern: "scrollbar-color.*var\\(--scrollbar-thumb\\).*var\\(--scrollbar-track\\)"
---

<objective>
Rewrite globals.css to establish the complete semantic CSS variable token system, migrate dark theme selector from `.dark` class to `[data-theme="dark"]` attribute, add application-level semantic tokens, implement theme-aware scrollbar styles with standards-first approach, and define type scale with font weight conventions.

Purpose: This is the CSS foundation that all downstream theming work (Phases 23-26) depends on. Without semantic tokens, theme switching has nothing to cascade through. Without the data-theme selector migration, next-themes cannot control the theme.

Output: A fully rewritten `globals.css` with semantic token system, scrollbar styles, and type scale.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-theme-foundation-color-token-migration/22-RESEARCH.md
@apps/web/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate globals.css token system and dark theme selector</name>
  <files>apps/web/src/app/globals.css</files>
  <action>
Rewrite `apps/web/src/app/globals.css` with the following structure. Preserve ALL existing token values exactly (oklch values must not change). The file structure must be:

**1. Imports (unchanged):**
```css
@import "tailwindcss";
@import "tw-animate-css";
```

**2. Custom variant migration (THEME-05):**
Replace:
```css
@custom-variant dark (&:is(.dark *));
```
With:
```css
@custom-variant dark (&:where([data-theme="dark"] *));
```
Use `:where()` not `:is()` for zero-specificity (prevents specificity wars with component styles).

**3. @theme inline block -- add application-level semantic tokens (THEME-01, THEME-04, TYPE-01, TYPE-02):**
Keep ALL existing tokens in @theme inline. ADD these new tokens after the existing ones:

```css
/* Application-level semantic tokens */
--color-app-bg: var(--app-bg);
--color-app-sidebar: var(--app-sidebar);
--color-app-sidebar-hover: var(--app-sidebar-hover);
--color-scrollbar-thumb: var(--scrollbar-thumb);
--color-scrollbar-thumb-hover: var(--scrollbar-thumb-hover);
--color-scrollbar-track: var(--scrollbar-track);
--color-table-header-bg: var(--table-header-bg);
--color-table-row-hover: var(--table-row-hover);
--color-table-border: var(--table-border);

/* Type scale - 1.2 ratio (minor third) */
--text-caption: 0.694rem;
--text-label: 0.833rem;
--text-body: 1rem;
--text-heading-sm: 1.2rem;
--text-heading-md: 1.44rem;
--text-heading-lg: 1.728rem;

/* Font weight conventions */
--font-weight-regular: 400;
--font-weight-medium: 500;
--font-weight-semibold: 600;
```

**4. Move :root and dark theme into @layer base (THEME-03):**
Wrap the existing `:root` and dark theme blocks inside `@layer base`. Change `.dark` selector to `[data-theme="dark"]`.

In `:root`, ADD these new application semantic token values after existing ones:
```css
/* Application semantic tokens (light) */
--app-bg: oklch(0.98 0 0);
--app-sidebar: oklch(0.96 0 0);
--app-sidebar-hover: oklch(0.94 0 0);
--scrollbar-thumb: oklch(0.7 0 0);
--scrollbar-thumb-hover: oklch(0.6 0 0);
--scrollbar-track: oklch(0.92 0 0);
--table-header-bg: oklch(0.95 0 0);
--table-row-hover: oklch(0.97 0 0);
--table-border: oklch(0.9 0 0);
```

In `[data-theme="dark"]`, keep ALL existing dark values (previously under `.dark`) and ADD:
```css
/* Application semantic tokens (dark) */
--app-bg: oklch(0.145 0 0);
--app-sidebar: oklch(0.205 0 0);
--app-sidebar-hover: oklch(0.25 0 0);
--scrollbar-thumb: oklch(0.556 0 0);
--scrollbar-thumb-hover: oklch(0.708 0 0);
--scrollbar-track: oklch(0.269 0 0);
--table-header-bg: oklch(0.18 0 0);
--table-row-hover: oklch(0.22 0 0);
--table-border: oklch(1 0 0 / 10%);
```

**5. Keep existing @layer base rules** (the `*` and `body` rules) after the theme values.

IMPORTANT: Preserve every single existing oklch value. Do NOT change any existing token values. Only ADD new tokens and CHANGE selectors (.dark -> [data-theme="dark"], @custom-variant pattern).
  </action>
  <verify>
1. Run `cd apps/web && npx next build 2>&1 | head -20` -- build should not error
2. Grep for `.dark {` in globals.css -- should return NO matches (migrated to [data-theme="dark"])
3. Grep for `@custom-variant dark` -- should contain `data-theme` not `.dark`
4. Grep for `--color-app-bg` in globals.css -- should exist in @theme inline
5. Grep for `--app-bg` in globals.css -- should exist in both :root and [data-theme="dark"]
6. Grep for `--text-caption` in globals.css -- should exist in @theme inline
7. Grep for `--font-weight-regular` in globals.css -- should exist
  </verify>
  <done>
- `.dark` class selector is replaced with `[data-theme="dark"]` attribute selector
- `@custom-variant dark` uses `&:where([data-theme="dark"] *)` pattern
- All existing shadcn token values preserved exactly (oklch values unchanged)
- 9 new application-level color tokens defined in both @theme inline and :root/[data-theme="dark"]
- 6 type scale sizes and 3 font weight conventions defined in @theme inline
- :root and theme blocks wrapped in @layer base
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite scrollbar styles with standards-first approach</name>
  <files>apps/web/src/app/globals.css</files>
  <action>
Replace the existing scrollbar section at the bottom of `globals.css` (the `.scrollbar-thin` block with hardcoded hex values `#4b5563`, `#1f2937`, `#6b7280`) with theme-aware, standards-first scrollbar styles.

**Replace the entire scrollbar section with:**

```css
/* ============================================
   Theme-aware scrollbar styles
   SCROLL-01: CSS variable colors
   SCROLL-02: scrollbar-gutter: stable
   SCROLL-03: Auto-hide (CSS opacity on wrapper)
   SCROLL-04: Hover expansion
   SCROLL-05: Standards-first, webkit fallback
   ============================================ */

/* Standards-first approach (Chrome 121+, Firefox 64+) */
.scrollbar-thin {
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
  scrollbar-width: thin;
}

/* scrollbar-gutter: stable prevents layout shift when scrollbar appears/disappears */
.scrollbar-gutter-stable {
  scrollbar-gutter: stable;
}

/* Progressive enhancement: webkit fallback for older browsers */
@supports selector(::-webkit-scrollbar) {
  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
    height: 6px;
    transition: width 0.2s ease;
  }

  .scrollbar-thin::-webkit-scrollbar-track {
    background: var(--scrollbar-track);
    border-radius: 3px;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 3px;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
  }

  .scrollbar-thin::-webkit-scrollbar-corner {
    background: var(--scrollbar-track);
  }

  /* SCROLL-04: Hover expansion -- wider track on container hover for easier grabbing */
  .scrollbar-thin:hover::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }
}

/* SCROLL-03: Auto-hide scrollbar wrapper
   Uses opacity to show/hide scrollbar area on hover.
   Note: OS overlay scrollbars handle this natively.
   This class provides explicit control for always-visible scrollbar OSes. */
.scrollbar-auto-hide {
  scrollbar-color: transparent transparent;
  transition: scrollbar-color 0.3s ease;
}

.scrollbar-auto-hide:hover,
.scrollbar-auto-hide:focus-within {
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
}

@supports selector(::-webkit-scrollbar) {
  .scrollbar-auto-hide::-webkit-scrollbar-thumb {
    background: transparent;
    transition: background 0.3s ease;
  }

  .scrollbar-auto-hide:hover::-webkit-scrollbar-thumb,
  .scrollbar-auto-hide:focus-within::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
  }

  .scrollbar-auto-hide::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollbar-auto-hide:hover::-webkit-scrollbar-track,
  .scrollbar-auto-hide:focus-within::-webkit-scrollbar-track {
    background: var(--scrollbar-track);
  }
}
```

**Key decisions:**
- Default width is 6px (slim), expands to 10px on hover (SCROLL-04)
- Standards properties (`scrollbar-color`, `scrollbar-width`) are primary (SCROLL-05)
- `@supports selector(::-webkit-scrollbar)` wraps all webkit rules to prevent Chrome 121+ conflicts
- `scrollbar-gutter: stable` is a separate utility class `.scrollbar-gutter-stable` (not forced on all scrollbar-thin elements) because it only makes sense on containers where scrollbar appearance changes dynamically (SCROLL-02)
- Auto-hide (SCROLL-03) uses `scrollbar-color: transparent transparent` technique with transition, which works in Firefox; webkit fallback provided
- No JS scrollbar libraries (project constraint)

**Do NOT** use `scrollbar-gutter: stable both-edges` (Chrome bug per research).
  </action>
  <verify>
1. Grep for hardcoded hex in scrollbar section (`#4b5563`, `#1f2937`, `#6b7280`) -- should return NO matches
2. Grep for `var(--scrollbar-thumb)` -- should appear in scrollbar rules
3. Grep for `scrollbar-gutter: stable` -- should exist in `.scrollbar-gutter-stable`
4. Grep for `@supports selector(::-webkit-scrollbar)` -- should exist (progressive enhancement guard)
5. Grep for `.scrollbar-auto-hide` -- should exist (SCROLL-03)
6. Grep for `:hover::-webkit-scrollbar` -- should exist (SCROLL-04 hover expansion)
7. Run `cd apps/web && npx next build 2>&1 | head -20` -- no CSS parse errors
  </verify>
  <done>
- All hardcoded hex values (#4b5563, #1f2937, #6b7280) replaced with CSS variable references
- scrollbar-color and scrollbar-width are primary properties (standards-first, SCROLL-05)
- Webkit pseudo-elements wrapped in @supports guard (SCROLL-05)
- .scrollbar-gutter-stable utility class created (SCROLL-02)
- .scrollbar-auto-hide utility class created with opacity transitions (SCROLL-03)
- Hover expansion from 6px to 10px on container hover (SCROLL-04)
- All scrollbar colors reference theme variables (SCROLL-01)
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Token system integrity:** `globals.css` contains `@theme inline` with all existing + new application tokens
2. **Dark theme migration:** No `.dark` class selector remains; `[data-theme="dark"]` is used instead
3. **Custom variant:** `@custom-variant dark` uses `&:where([data-theme="dark"] *)`
4. **Scrollbar theming:** All scrollbar styles use CSS variables, no hardcoded hex
5. **Type scale:** 6 type sizes and 3 font weights defined as CSS variables
6. **Build check:** `npm run build` in apps/web succeeds without CSS errors

Note: The app will temporarily show light theme (no .dark class on HTML anymore, and no ThemeProvider yet to set data-theme). This is expected -- Plan 02 adds the ThemeProvider which restores dark theme functionality.
</verification>

<success_criteria>
- globals.css has been fully rewritten with semantic token system
- Zero hardcoded hex colors in scrollbar styles
- `.dark` class selector fully replaced with `[data-theme="dark"]`
- All 12 Phase 22 requirements (THEME-01 through THEME-05, SCROLL-01 through SCROLL-05, TYPE-01, TYPE-02) have CSS foundation in place
- Next.js build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/22-theme-foundation-color-token-migration/22-01-SUMMARY.md`
</output>
