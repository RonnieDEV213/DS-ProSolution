---
phase: 11-collection-bug-fixes-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/admin/collection/sellers-grid.tsx
autonomous: true

must_haves:
  truths:
    - "X delete button removed from individual seller cards"
    - "Delete only available via toolbar when items selected"
    - "Shift+click selects range between anchor and target"
    - "Visual preview shows on Shift+hover before clicking"
    - "Clicking empty grid space deselects all"
  artifacts:
    - path: "apps/web/src/components/admin/collection/sellers-grid.tsx"
      provides: "Range selection and delete UI changes"
      contains: "selectionAnchor"
  key_links:
    - from: "SellerCell component"
      to: "Selection state"
      via: "Shift+click handler"
      pattern: "shiftKey"
---

<objective>
Improve selection behavior and delete UX in sellers grid

Purpose: Implement standard file-explorer-like selection (Shift+click range), remove per-card delete button, deselect on empty space click
Output: More intuitive selection and deletion workflow matching OS file manager conventions
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-collection-bug-fixes-polish/11-CONTEXT.md
@.planning/phases/11-collection-bug-fixes-polish/11-RESEARCH.md
@apps/web/src/components/admin/collection/sellers-grid.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove X delete button from seller cards</name>
  <files>apps/web/src/components/admin/collection/sellers-grid.tsx</files>
  <action>
  Per CONTEXT.md: "Remove X delete button from seller cards entirely - delete only via toolbar"

  In the SellerCell component (around line 113-169), remove the X button that appears on hover.

  Remove this entire block (around lines 156-164):
  ```tsx
  <button
    onClick={(e) => {
      e.stopPropagation();
      onDelete(seller.id);
    }}
    className="flex-shrink-0 opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-400 ml-1"
  >
    <X className="h-3 w-3" />
  </button>
  ```

  The bulk delete via toolbar (handleBulkDelete at line 394) remains unchanged. Users delete by:
  1. Select one or more sellers (click, drag, Ctrl+A)
  2. Click the delete button in toolbar (Trash2 icon)

  Also remove `onDelete` from the CellProps interface and cellProps useMemo since it's no longer needed in the cell component. Remove it from:
  - CellProps interface (line 57)
  - SellerCell destructuring (line 81)
  - cellProps useMemo (around line 1055)
  </action>
  <verify>
  Run `npm run lint` in apps/web to verify no syntax errors.
  Verify by reading the file that the X button is removed from SellerCell.
  </verify>
  <done>
  X delete button removed from individual seller cards, delete only available via toolbar
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Shift+click range selection</name>
  <files>apps/web/src/components/admin/collection/sellers-grid.tsx</files>
  <action>
  Add standard range selection: Shift+click selects all sellers between anchor (last clicked) and target.

  1. Add selection anchor state:
  ```typescript
  const [selectionAnchor, setSelectionAnchor] = useState<number | null>(null);
  ```

  2. Add hover preview state for Shift+hover:
  ```typescript
  const [shiftHoverTarget, setShiftHoverTarget] = useState<number | null>(null);
  const [shiftPreviewIds, setShiftPreviewIds] = useState<Set<string>>(new Set());
  ```

  3. Modify handleSellerClick to support Shift+click range selection:
  ```typescript
  const handleSellerClick = useCallback((seller: Seller, event: React.MouseEvent) => {
    if ((event.target as HTMLElement).closest('button')) return;
    if (editingId === seller.id) return;

    const index = filteredSellers.findIndex(s => s.id === seller.id);

    if (clickTimeoutRef.current) {
      clearTimeout(clickTimeoutRef.current);
      clickTimeoutRef.current = null;
      setEditingId(seller.id);
      setEditValue(seller.display_name);
      return;
    }

    clickTimeoutRef.current = setTimeout(() => {
      clickTimeoutRef.current = null;

      if (event.shiftKey && selectionAnchor !== null) {
        // Range select: from anchor to current
        const start = Math.min(selectionAnchor, index);
        const end = Math.max(selectionAnchor, index);
        const rangeIds = new Set(
          filteredSellers.slice(start, end + 1).map(s => s.id)
        );
        setSelectedIds(rangeIds);
      } else if (event.ctrlKey || event.metaKey) {
        // Toggle individual item, keep anchor
        toggleSelection(seller.id);
        setSelectionAnchor(index);
      } else {
        // Normal click: select single, set as anchor
        setSelectedIds(new Set([seller.id]));
        setSelectionAnchor(index);
      }

      // Clear shift preview
      setShiftPreviewIds(new Set());
      setShiftHoverTarget(null);
    }, 200);
  }, [editingId, filteredSellers, selectionAnchor, toggleSelection]);
  ```

  4. Add Shift+hover preview in SellerCell. Pass shiftPreviewIds to cellProps and style cells that are in the preview range:
  ```typescript
  // In CellProps interface, add:
  shiftPreviewIds: Set<string>;

  // In cellProps useMemo, add:
  shiftPreviewIds,

  // In SellerCell, add styling for preview:
  const isInShiftPreview = shiftPreviewIds.has(seller.id);
  // Add to className: isInShiftPreview && "ring-1 ring-blue-400/50"
  ```

  5. Handle mouse movement with Shift key to update preview:
  ```typescript
  // In SellerCell onMouseEnter, add shift preview logic:
  onMouseEnter={(e) => {
    if (!isDragging()) {
      const rect = e.currentTarget.getBoundingClientRect();
      onHoverEnter(seller, rect, e.shiftKey);
    }
  }}
  ```

  Update onHoverEnter signature to include shiftKey parameter and calculate preview range if Shift is held and there's an anchor.
  </action>
  <verify>
  Run `npm run lint` in apps/web to verify no syntax errors.
  Test in browser: click seller to set anchor, Shift+hover shows preview, Shift+click selects range.
  </verify>
  <done>
  Shift+click selects range, Shift+hover shows visual preview of range
  </done>
</task>

<task type="auto">
  <name>Task 3: Deselect when clicking empty grid space</name>
  <files>apps/web/src/components/admin/collection/sellers-grid.tsx</files>
  <action>
  Per CONTEXT.md: "Clicking empty space in grid deselects all selected items"

  The grid container has handleMouseDown for drag selection. Add logic to detect clicks on empty space (not on a seller cell) and deselect.

  Modify handleMouseDown to check if click is on empty space:
  ```typescript
  const handleMouseDown = useCallback((e: React.MouseEvent) => {
    // ... existing checks for button, input, data-no-drag ...

    const container = gridContainerRef.current;
    if (!container) return;

    const rect = container.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const scrollTop = gridRef.current?.element?.scrollTop || 0;

    // Check if click is on a seller cell
    const pos = getGridPositionFromPixels(x, y, scrollTop);
    const index = pos.row * columnCount + pos.col;
    const clickedOnSeller = index < filteredSellers.length;

    if (e.button === 2) {
      // Right-click: existing flag painting logic...
    } else {
      // Left-click
      if (!clickedOnSeller) {
        // Clicked empty space - deselect all
        setSelectedIds(new Set());
        setSelectionAnchor(null);
        return; // Don't start drag selection
      }

      // Otherwise start drag selection as normal...
      isDraggingRef.current = true;
      // ...
    }
  }, [/* deps */]);
  ```

  This handles the case where user clicks in the grid area but not on an actual seller cell (e.g., clicking in padding or below the last row).
  </action>
  <verify>
  Run `npm run lint` in apps/web to verify no syntax errors.
  Test in browser: select some sellers, click on empty space below grid content, selection should clear.
  </verify>
  <done>
  Clicking empty grid space deselects all, selection anchor cleared
  </done>
</task>

</tasks>

<verification>
- [ ] X delete button removed from seller cards
- [ ] Delete only available via toolbar (Trash2 icon in header)
- [ ] Shift+click selects range between anchor and target
- [ ] Shift+hover shows preview of range before clicking
- [ ] Click on empty grid space deselects all
- [ ] No lint errors
</verification>

<success_criteria>
- Selection behavior matches standard file explorer conventions
- Delete workflow simplified: select then toolbar delete
- Visual feedback for range selection preview
</success_criteria>

<output>
After completion, create `.planning/phases/11-collection-bug-fixes-polish/11-03-SUMMARY.md`
</output>
