---
phase: 02.1-profile-ui-refinements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/profile/security-tab.tsx
  - apps/web/src/components/profile/extension-tab.tsx
  - apps/web/src/components/profile/profile-settings-dialog.tsx
  - apps/web/src/components/admin/sidebar.tsx
  - apps/web/src/app/va/layout.tsx
  - apps/web/src/app/client/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Profile modal close button is replaced with Sign Out button"
    - "Sidebar bottom-left shows 'Profile Settings' text with icon (no name/email/sign out)"
    - "Profile modal has Security tab containing access code UI"
    - "Extension tab no longer contains access code section"
  artifacts:
    - path: "apps/web/src/components/profile/security-tab.tsx"
      provides: "Security tab with access code display"
      exports: ["SecurityTab"]
    - path: "apps/web/src/components/profile/extension-tab.tsx"
      provides: "Extension download/install only (no access code)"
    - path: "apps/web/src/components/profile/profile-settings-dialog.tsx"
      provides: "Dialog with Profile/Security/Extension tabs and Sign Out button"
    - path: "apps/web/src/components/admin/sidebar.tsx"
      provides: "Admin sidebar with Profile Settings trigger (no user info)"
    - path: "apps/web/src/app/va/layout.tsx"
      provides: "VA layout with Profile Settings trigger (no user info)"
    - path: "apps/web/src/app/client/layout.tsx"
      provides: "Client layout with Profile Settings trigger (no user info)"
  key_links:
    - from: "apps/web/src/components/profile/profile-settings-dialog.tsx"
      to: "apps/web/src/components/profile/security-tab.tsx"
      via: "import SecurityTab"
      pattern: "import.*SecurityTab"
    - from: "apps/web/src/components/profile/security-tab.tsx"
      to: "apps/web/src/components/profile/access-code-display.tsx"
      via: "import AccessCodeDisplay"
      pattern: "import.*AccessCodeDisplay"
---

<objective>
Reorganize the Profile Settings modal tabs and sidebar trigger for cleaner UX.

Purpose: Move access code to Security tab, simplify sidebar to just a "Profile Settings" trigger, and move Sign Out from sidebar into the modal.
Output: Updated profile modal with Security tab, cleaner sidebars without user info display, sign out moved into modal.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference existing profile components
@apps/web/src/components/profile/profile-settings-dialog.tsx
@apps/web/src/components/profile/extension-tab.tsx
@apps/web/src/components/profile/access-code-display.tsx
@apps/web/src/components/admin/sidebar.tsx
@apps/web/src/app/va/layout.tsx
@apps/web/src/app/client/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Security tab and simplify Extension tab</name>
  <files>
    apps/web/src/components/profile/security-tab.tsx
    apps/web/src/components/profile/extension-tab.tsx
  </files>
  <action>
1. Create `security-tab.tsx`:
   - New component: `SecurityTab` (no props needed - AccessCodeDisplay handles its own state)
   - Content:
     - Section heading "Access Code" with description about authenticating the extension
     - Import and render `<AccessCodeDisplay />` component
   - Match the existing styling from extension-tab.tsx (space-y-4, heading styles, etc.)

2. Modify `extension-tab.tsx`:
   - Remove the `showAccessCode` check and entire "Access Code Section" block (lines 77-89)
   - Update step 3 text: change from "Enter your access code below to pair the extension" to "Use your access code from Security tab to authenticate"
   - For clients (no access code), step 3 remains "Follow the pairing instructions in the extension"
   - Remove the AccessCodeDisplay import (no longer used here)
   - Keep role prop since step 3 text differs for admin/va vs client
  </action>
  <verify>
    - `security-tab.tsx` exists and exports `SecurityTab`
    - `extension-tab.tsx` no longer imports `AccessCodeDisplay`
    - `extension-tab.tsx` no longer has access code section JSX
    - TypeScript compiles: `cd apps/web && npx tsc --noEmit`
  </verify>
  <done>
    - SecurityTab component created with AccessCodeDisplay
    - ExtensionTab only shows download/install content
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Profile Settings dialog with Security tab and Sign Out</name>
  <files>
    apps/web/src/components/profile/profile-settings-dialog.tsx
  </files>
  <action>
1. Import the new SecurityTab component

2. Update Tab type to include "security":
   - Change from `"profile" | "extension"` to `"profile" | "security" | "extension"`

3. Add Security tab navigation button (after Profile, before Extension):
   - Only render Security tab button if role is "admin" or "va"
   - Match existing button styling pattern

4. Render SecurityTab when activeTab is "security":
   - Add `{activeTab === "security" && <SecurityTab />}` in the content area
   - Only render if role allows (admin/va) - same condition as nav button

5. Replace "Close" button with "Sign Out" button:
   - Import `useRouter` from "next/navigation"
   - Add router = useRouter() in component
   - Create handleSignOut function:
     ```
     const handleSignOut = async () => {
       const supabase = createClient();
       await supabase.auth.signOut();
       onOpenChange(false);
       router.push("/login");
     };
     ```
   - Change button text from "Close" to "Sign Out"
   - Change onClick from `() => onOpenChange(false)` to `handleSignOut`
   - Add sign-out icon (same SVG used in sidebars)
   - Style: text-red-400 hover:bg-red-900/20 hover:text-red-300 for visual distinction
  </action>
  <verify>
    - Security tab appears in nav for admin/va users
    - Security tab shows access code UI when selected
    - Close button is now "Sign Out" with icon
    - Clicking Sign Out logs out user and closes modal
    - TypeScript compiles: `cd apps/web && npx tsc --noEmit`
  </verify>
  <done>
    - Profile modal has Security tab (admin/va only) with access code UI
    - Close button replaced with Sign Out button that logs out user
  </done>
</task>

<task type="auto">
  <name>Task 3: Simplify sidebar profile triggers</name>
  <files>
    apps/web/src/components/admin/sidebar.tsx
    apps/web/src/app/va/layout.tsx
    apps/web/src/app/client/layout.tsx
  </files>
  <action>
For each of the three files, make these changes:

1. Remove user info state (no longer needed in sidebar):
   - Delete `userEmail` and `displayName` useState declarations
   - Delete the useEffect that fetches user data (email/display_name)

2. Remove the standalone Sign Out button (moved to modal):
   - Delete `handleSignOut` function
   - Delete the Sign Out button JSX

3. Replace user info button with simple "Profile Settings" trigger:
   - Change from showing displayName/userEmail to showing:
     ```jsx
     <button
       onClick={() => setProfileOpen(true)}
       className="flex items-center gap-3 px-4 py-3 w-full rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors"
     >
       {/* Settings/cog icon */}
       <svg
         className="w-5 h-5"
         fill="none"
         stroke="currentColor"
         viewBox="0 0 24 24"
       >
         <path
           strokeLinecap="round"
           strokeLinejoin="round"
           strokeWidth={2}
           d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
         />
         <path
           strokeLinecap="round"
           strokeLinejoin="round"
           strokeWidth={2}
           d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
         />
       </svg>
       Profile Settings
     </button>
     ```

4. Keep the ProfileSettingsDialog at the bottom with `profileOpen` state
  </action>
  <verify>
    - Admin sidebar shows "Profile Settings" button with cog icon
    - VA sidebar shows "Profile Settings" button with cog icon
    - Client sidebar shows "Profile Settings" button with cog icon
    - No user name/email displayed in any sidebar
    - No standalone Sign Out button in any sidebar
    - Clicking "Profile Settings" opens the modal
    - TypeScript compiles: `cd apps/web && npx tsc --noEmit`
  </verify>
  <done>
    - All three sidebars show simple "Profile Settings" trigger
    - No user info (name/email) in sidebars
    - No standalone sign out buttons in sidebars
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run TypeScript check: `cd apps/web && npx tsc --noEmit`
2. Start dev server: `cd apps/web && npm run dev`
3. Manual verification:
   - Login as admin: sidebar shows "Profile Settings" (not name/email)
   - Click "Profile Settings": modal opens with Profile, Security, Extension tabs
   - Security tab: shows access code UI
   - Extension tab: shows download only (no access code section)
   - Modal has "Sign Out" button at bottom-left (not "Close")
   - Click "Sign Out": logs out, redirects to /login
</verification>

<success_criteria>
- Profile modal close button replaced with Sign Out button (calls sign out + closes + redirects)
- Sidebar bottom-left shows "Profile Settings" text with cog icon (no name/email/sign out)
- Profile modal has Security tab (admin/va only) containing access code UI
- Extension tab no longer contains access code section
- All three layouts (admin, va, client) have simplified sidebar
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-profile-ui-refinements/02.1-01-SUMMARY.md`
</output>
