---
phase: 10-collection-ui-cleanup
plan: 05
type: execute
wave: 3
depends_on: ["10-01", "10-02", "10-03", "10-04"]
files_modified:
  - apps/web/src/app/admin/automation/page.tsx
  - apps/web/src/components/admin/collection/recent-logs-sidebar.tsx
  - apps/web/src/components/admin/collection/collection-history.tsx
  - apps/web/src/components/admin/collection/schedule-config.tsx
autonomous: true

must_haves:
  truths:
    - "Automation page uses new HistoryPanel component"
    - "Automation page uses new HierarchicalRunModal"
    - "Old RecentLogsSidebar is no longer imported"
    - "Old CollectionHistory is no longer imported"
    - "Old ScheduleConfig is no longer imported"
    - "Layout adjusted for history panel on right side"
  artifacts:
    - path: "apps/web/src/app/admin/automation/page.tsx"
      provides: "Integrated page with new components"
      contains: "HistoryPanel|HierarchicalRunModal"
  key_links:
    - from: "apps/web/src/app/admin/automation/page.tsx"
      to: "components/admin/collection/history-panel"
      via: "import statement"
      pattern: "from.*history-panel"
---

<objective>
Integrate new components into automation page and remove deprecated components. Adjust layout to accommodate wider history panel.

Purpose: Wire up all new components (history-panel, hierarchical-run-modal, enhanced sellers-grid, consolidated run-config-modal) and remove old redundant components (recent-logs-sidebar, collection-history, schedule-config).
Output: Cleaned up automation page with new UI structure.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-collection-ui-cleanup/10-CONTEXT.md
@apps/web/src/app/admin/automation/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update automation page imports and layout</name>
  <files>apps/web/src/app/admin/automation/page.tsx</files>
  <action>
**Update imports:**

Remove:
```typescript
import { RecentLogsSidebar } from "@/components/admin/collection/recent-logs-sidebar";
import { CollectionHistory } from "@/components/admin/collection/collection-history";
import { ScheduleConfig } from "@/components/admin/collection/schedule-config";
```

Add:
```typescript
import { HistoryPanel } from "@/components/admin/collection/history-panel";
import { HierarchicalRunModal } from "@/components/admin/collection/hierarchical-run-modal";
```

**Add state for hierarchical run modal:**
```typescript
const [hierarchicalRunOpen, setHierarchicalRunOpen] = useState(false);
const [selectedRunId, setSelectedRunId] = useState<string | null>(null);
```

**Update layout structure:**

Change main content grid from:
```typescript
<div className="flex gap-4 h-[calc(100vh-400px)] min-h-[400px]">
  {/* Sellers Grid */}
  <div className="flex-1 min-w-0">
    <SellersGrid ... />
  </div>
  {/* Recent Logs Sidebar */}
  <div className="w-64 flex-shrink-0">
    <RecentLogsSidebar ... />
  </div>
</div>
```

To:
```typescript
<div className="flex gap-4 h-[calc(100vh-300px)] min-h-[500px]">
  {/* Sellers Grid - reduced columns per CONTEXT.md */}
  <div className="flex-1 min-w-0">
    <SellersGrid
      refreshTrigger={refreshTrigger}
      onSellerChange={handleRefresh}
      newSellerIds={newSellerIds}
    />
  </div>
  {/* History Panel - wider than old sidebar */}
  <div className="w-80 flex-shrink-0">
    <HistoryPanel
      refreshTrigger={refreshTrigger}
      onStartRunClick={() => setRunConfigOpen(true)}
      hasActiveRun={!!activeRun}
      onManualEditClick={handleLogClick}
      onCollectionRunClick={(runId) => {
        setSelectedRunId(runId);
        setHierarchicalRunOpen(true);
      }}
    />
  </div>
</div>
```

**Remove old sections:**
Remove the `<CollectionHistory>` and `<ScheduleConfig>` components that were below the main grid.

**Add new modal:**
```typescript
<HierarchicalRunModal
  open={hierarchicalRunOpen}
  onOpenChange={setHierarchicalRunOpen}
  runId={selectedRunId}
/>
```

**Update handlers:**

The handleLogClick remains for manual edits (opens LogDetailModal).
Add handler for collection run clicks (opens HierarchicalRunModal).
  </action>
  <verify>
Page loads without errors. New HistoryPanel appears on right. Clicking collection run opens hierarchical modal. Clicking manual edit opens log detail modal.
  </verify>
  <done>Automation page updated with new components and layout adjustments</done>
</task>

<task type="auto">
  <name>Task 2: Mark deprecated components</name>
  <files>
    apps/web/src/components/admin/collection/recent-logs-sidebar.tsx
    apps/web/src/components/admin/collection/collection-history.tsx
    apps/web/src/components/admin/collection/schedule-config.tsx
  </files>
  <action>
Add deprecation notice to top of each file. Do NOT delete files (per CLAUDE.md guardrails).

**recent-logs-sidebar.tsx:**
```typescript
/**
 * @deprecated This component has been replaced by HistoryPanel in Phase 10.
 * Kept for reference but no longer used in automation page.
 * See: history-panel.tsx
 */
"use client";
// ... rest of file unchanged
```

**collection-history.tsx:**
```typescript
/**
 * @deprecated This component has been replaced by HistoryPanel in Phase 10.
 * Functionality merged into unified history timeline.
 * See: history-panel.tsx, hierarchical-run-modal.tsx
 */
"use client";
// ... rest of file unchanged
```

**schedule-config.tsx:**
```typescript
/**
 * @deprecated This component has been merged into RunConfigModal in Phase 10.
 * Schedule configuration is now part of the run config two-panel layout.
 * See: run-config-modal.tsx
 */
"use client";
// ... rest of file unchanged
```
  </action>
  <verify>
Files still exist with deprecation comments. No import errors in the codebase.
  </verify>
  <done>Deprecated components marked with JSDoc comments pointing to replacements</done>
</task>

<task type="auto">
  <name>Task 3: Final verification and build</name>
  <files>apps/web/src/app/admin/automation/page.tsx</files>
  <action>
Run full build to verify all components work together:

```bash
cd apps/web && npm run build
```

Fix any TypeScript errors that arise from the integration.

Test the following user flows mentally through the code:
1. Load Collections tab - should show sellers grid + history panel
2. Click "Start Collection" - should open run-config-modal with two-panel layout
3. Toggle schedule in run-config-modal - should show calendar
4. Click collection run in history - should open hierarchical-run-modal
5. Click manual edit in history - should open log-detail-modal
6. Hover over seller - should show hover card
7. Drag select sellers - should show selection box and select multiple
8. Click delete with selection - should bulk delete

If any component is missing exports or has type mismatches, fix them.
  </action>
  <verify>
`npm run build` passes without errors. No TypeScript type errors. No missing imports.
  </verify>
  <done>Full build passes; all components integrated and working together</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` in apps/web passes without errors
- [ ] Automation page loads Collections tab without errors
- [ ] HistoryPanel renders on right side
- [ ] HierarchicalRunModal opens when clicking collection run
- [ ] LogDetailModal opens when clicking manual edit
- [ ] RunConfigModal has two-panel layout with scheduling
- [ ] SellersGrid has selection and hover cards
- [ ] Deprecated components have JSDoc comments
- [ ] Old CollectionHistory and ScheduleConfig sections removed from page
</verification>

<success_criteria>
Phase 10 complete: Automation page uses all new components. Old redundant components deprecated. Two-phase progress bar, unified history panel, enhanced sellers grid with selection/hover, consolidated run config modal with scheduling all working together. UI is cleaner and more intuitive.
</success_criteria>

<output>
After completion, create `.planning/phases/10-collection-ui-cleanup/10-05-SUMMARY.md`
</output>
