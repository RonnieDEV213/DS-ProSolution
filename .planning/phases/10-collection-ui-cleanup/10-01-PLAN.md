---
phase: 10-collection-ui-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/ui/calendar.tsx
  - apps/web/src/components/ui/hover-card.tsx
  - apps/web/src/components/ui/popover.tsx
  - apps/web/src/components/admin/collection/progress-bar.tsx
  - apps/web/src/components/admin/collection/progress-detail-modal.tsx
  - apps/web/package.json
autonomous: true

must_haves:
  truths:
    - "Progress bar shows distinct Amazon and eBay phases"
    - "Amazon phase displays departments, categories, and live product count"
    - "eBay phase displays cascading progress (product->category->department)"
    - "Progress bar no longer shows 3/0 invalid ratios"
  artifacts:
    - path: "apps/web/src/components/ui/calendar.tsx"
      provides: "shadcn calendar component for scheduling"
    - path: "apps/web/src/components/ui/hover-card.tsx"
      provides: "shadcn hover-card for seller metadata preview"
    - path: "apps/web/src/components/ui/popover.tsx"
      provides: "shadcn popover component"
    - path: "apps/web/src/components/admin/collection/progress-bar.tsx"
      provides: "Two-phase progress display"
      contains: "phase.*amazon|ebay"
  key_links:
    - from: "apps/web/src/components/admin/collection/progress-bar.tsx"
      to: "progress.phase"
      via: "conditional rendering based on phase field"
      pattern: "phase.*===.*amazon|ebay"
---

<objective>
Install required shadcn components and rework the progress bar to display two distinct phases (Amazon collecting, eBay searching).

Purpose: The current progress bar shows invalid ratios like "3/0 products" because totals aren't set until Amazon phase completes. Two-phase display fixes this and provides clearer feedback.
Output: New shadcn components installed; progress bar showing phase-appropriate metrics.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-collection-ui-cleanup/10-CONTEXT.md
@.planning/phases/10-collection-ui-cleanup/10-RESEARCH.md
@apps/web/src/components/admin/collection/progress-bar.tsx
@apps/web/src/components/admin/collection/progress-detail-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn components and drag selection library</name>
  <files>
    apps/web/src/components/ui/calendar.tsx
    apps/web/src/components/ui/hover-card.tsx
    apps/web/src/components/ui/popover.tsx
    apps/web/package.json
  </files>
  <action>
From apps/web directory, install required components:

```bash
npx shadcn@latest add calendar
npx shadcn@latest add hover-card
npx shadcn@latest add popover
npm install @air/react-drag-to-select
```

The shadcn CLI will create the component files automatically. Verify files exist after installation.

Note: calendar depends on react-day-picker which will be installed automatically.
  </action>
  <verify>
```bash
ls apps/web/src/components/ui/calendar.tsx
ls apps/web/src/components/ui/hover-card.tsx
ls apps/web/src/components/ui/popover.tsx
cat apps/web/package.json | grep -E "@air/react-drag-to-select|react-day-picker"
```
All four checks should show files/dependencies exist.
  </verify>
  <done>shadcn calendar, hover-card, popover components exist; @air/react-drag-to-select in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Rework progress bar for two-phase display</name>
  <files>apps/web/src/components/admin/collection/progress-bar.tsx</files>
  <action>
Update ProgressBarProps interface to handle two-phase progress:

```typescript
interface ProgressBarProps {
  progress: {
    run_id: string;
    status: "running" | "paused" | "pending";
    phase: "amazon" | "ebay";  // NEW: current phase
    // Amazon phase fields
    departments_total: number;
    departments_completed: number;
    categories_total: number;
    categories_completed: number;
    products_found: number;  // NEW: live count during Amazon phase
    // eBay phase fields
    products_total: number;
    products_searched: number;
    sellers_found: number;
    sellers_new: number;
    started_at?: string;  // NEW: for duration display
    // Checkpoint for throttle status
    checkpoint?: {
      status?: "rate_limited" | "paused_failures" | string;
      waiting_seconds?: number;
      current_category?: string;
    };
  } | null;
  onDetailsClick: () => void;
  onRunStateChange: () => void;
}
```

Rework the UI to show phase-specific content:

**Amazon Phase (phase === "amazon"):**
- Header badge: "Collecting Best Sellers"
- Show: Depts: X/Y | Cats: X/Y | Products Found: N (live count, no denominator)
- Progress bar: categories_completed / categories_total

**eBay Phase (phase === "ebay"):**
- Header badge: "Searching Sellers"
- Show: Depts: X/Y | Cats: X/Y | Products: X/N | +New: N
- Progress bar: products_searched / products_total
- If started_at provided, show duration timer (format as Xm Ys using date-fns formatDistanceStrict)

Use Framer Motion for smooth phase transition (fade out/in when phase changes).

Default phase to "amazon" if not provided for backwards compatibility.
  </action>
  <verify>
TypeScript compilation: `cd apps/web && npm run build` should pass without type errors related to progress-bar.tsx
  </verify>
  <done>Progress bar conditionally renders Amazon vs eBay phase with appropriate metrics; no invalid X/0 ratios shown</done>
</task>

<task type="auto">
  <name>Task 3: Update progress detail modal for two-phase display</name>
  <files>apps/web/src/components/admin/collection/progress-detail-modal.tsx</files>
  <action>
Update ProgressDetailModalProps to match new progress interface (add phase field).

Remove worker_status display entirely (per CONTEXT.md - simplify, remove clutter).

Update modal content:

**Summary stats section:**
- Left card: Phase indicator ("Step 1: Collecting" or "Step 2: Searching") + current phase progress %
- Right card: New Sellers count (keep as-is)

**Hierarchical progress section:**
- Amazon phase: Show Departments, Categories progress bars only (no Products bar)
- eBay phase: Show all three (Departments, Categories, Products) with cascading logic noted

**Add duration display:**
- If started_at provided, show "Started: {time} ({Xm Ys ago})" using date-fns

**Minimized indicator updates:**
- Show phase name in badge: "Amazon: X%" or "eBay: X%"

Keep cancel button and minimize functionality as-is.
  </action>
  <verify>
TypeScript compilation passes. Visual inspection: modal no longer shows worker status section.
  </verify>
  <done>Progress detail modal shows two-phase structure with phase indicator; worker status removed; duration displayed</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` in apps/web passes without errors
- [ ] calendar.tsx, hover-card.tsx, popover.tsx exist in components/ui
- [ ] @air/react-drag-to-select appears in package.json dependencies
- [ ] progress-bar.tsx uses phase field for conditional rendering
- [ ] progress-detail-modal.tsx no longer references worker_status
</verification>

<success_criteria>
Progress bar and modal display phase-appropriate content (Amazon: departments/categories/products-found; eBay: departments/categories/products-searched/sellers). No X/0 invalid ratios. New shadcn components available for subsequent plans.
</success_criteria>

<output>
After completion, create `.planning/phases/10-collection-ui-cleanup/10-01-SUMMARY.md`
</output>
