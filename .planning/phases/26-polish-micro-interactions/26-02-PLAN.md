---
phase: 26-polish-micro-interactions
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/src/components/ui/command.tsx
  - apps/web/src/components/ui/kbd.tsx
  - apps/web/src/lib/shortcuts.ts
  - apps/web/src/lib/command-items.ts
autonomous: true

must_haves:
  truths:
    - "cmdk is installed via shadcn/ui command component"
    - "react-hotkeys-hook is installed as a dependency"
    - "Keyboard shortcut definitions exist in a central registry"
    - "Command palette items (navigation + actions) are defined"
    - "Kbd component renders keyboard shortcut badges"
  artifacts:
    - path: "apps/web/src/components/ui/command.tsx"
      provides: "shadcn/ui Command component primitives"
      exports: ["Command", "CommandDialog", "CommandInput", "CommandList", "CommandGroup", "CommandItem", "CommandShortcut", "CommandEmpty", "CommandSeparator"]
    - path: "apps/web/src/lib/shortcuts.ts"
      provides: "Central keyboard shortcut registry"
      exports: ["SHORTCUTS", "SHORTCUT_GROUPS"]
    - path: "apps/web/src/lib/command-items.ts"
      provides: "Navigation and action items for command palette"
      exports: ["navigationItems", "actionItems"]
    - path: "apps/web/src/components/ui/kbd.tsx"
      provides: "Keyboard shortcut badge component"
      exports: ["Kbd"]
  key_links:
    - from: "shortcuts.ts"
      to: "command-items.ts"
      via: "shortcut key strings shared between registry and palette items"
      pattern: "SHORTCUTS"
---

<objective>
Install command palette and keyboard shortcut dependencies, create the shortcut registry, command palette item definitions, and Kbd badge component.

Purpose: Establish all foundational pieces for the command palette (POLISH-09) and keyboard shortcuts (POLISH-10) so Plan 04 can assemble and integrate them.

Output: Installed cmdk + react-hotkeys-hook + shadcn/ui command/kbd components. Central shortcuts registry. Navigation/action item definitions. Kbd badge component.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@apps/web/src/lib/navigation.ts
@apps/web/src/types/navigation.ts
@apps/web/src/components/layout/app-sidebar.tsx
@apps/web/src/components/bookkeeping/keyboard-shortcuts-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and generate shadcn/ui command + kbd components</name>
  <files>apps/web/package.json, apps/web/src/components/ui/command.tsx, apps/web/src/components/ui/kbd.tsx</files>
  <action>
1. **Install react-hotkeys-hook:**
```bash
cd apps/web
pnpm add react-hotkeys-hook
```

2. **Generate shadcn/ui Command component:**
```bash
cd apps/web
pnpm dlx shadcn@latest add command
```
This installs `cmdk` as a dependency and generates `src/components/ui/command.tsx`.

3. **Create Kbd component** at `apps/web/src/components/ui/kbd.tsx`:
Since the shadcn/ui `kbd` component may not be available via CLI, create it manually:

```tsx
import * as React from "react"
import { cn } from "@/lib/utils"

function Kbd({
  className,
  ...props
}: React.HTMLAttributes<HTMLElement>) {
  return (
    <kbd
      className={cn(
        "pointer-events-none inline-flex h-5 items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground select-none",
        className
      )}
      {...props}
    />
  )
}

export { Kbd }
```

Styling notes:
- Uses `border-border bg-muted text-muted-foreground` for theme compatibility
- `font-mono text-[10px]` matches existing kbd pattern in keyboard-shortcuts-modal.tsx
- `pointer-events-none select-none` prevents interaction (decorative badge)
- `h-5` for consistent height alignment with text

4. **Verify installation:**
```bash
cd apps/web
pnpm list react-hotkeys-hook cmdk
```
Both packages should appear in the dependency list.

Important: If `pnpm dlx shadcn@latest add command` prompts for confirmation or has issues on Windows, manually create the command.tsx component based on the shadcn/ui source. The component wraps cmdk primitives with Tailwind classes.
  </action>
  <verify>
Run `pnpm list react-hotkeys-hook cmdk` in apps/web to confirm both packages installed. Verify `apps/web/src/components/ui/command.tsx` and `apps/web/src/components/ui/kbd.tsx` exist.
  </verify>
  <done>
react-hotkeys-hook and cmdk are installed. command.tsx exports Command, CommandDialog, CommandInput, CommandList, CommandGroup, CommandItem, CommandShortcut, CommandEmpty, CommandSeparator. kbd.tsx exports Kbd component.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shortcuts registry and command palette item definitions</name>
  <files>apps/web/src/lib/shortcuts.ts, apps/web/src/lib/command-items.ts</files>
  <action>
1. **Create `apps/web/src/lib/shortcuts.ts`** - Central keyboard shortcut registry:

```typescript
export interface ShortcutDefinition {
  key: string            // react-hotkeys-hook key string (e.g., "mod+k", "g,d")
  label: string          // Human-readable label
  description: string    // What this shortcut does
  display: string[]      // Display keys for Kbd badges (e.g., ["Ctrl", "K"] or ["G", "D"])
  group: string          // Category for grouping
  scope?: string         // Optional scope restriction
}

export const SHORTCUT_GROUPS = [
  "Navigation",
  "Actions",
  "Command Palette",
] as const

export type ShortcutGroup = typeof SHORTCUT_GROUPS[number]

export const SHORTCUTS: ShortcutDefinition[] = [
  // Command Palette
  {
    key: "mod+k",
    label: "Command Palette",
    description: "Open the command palette",
    display: ["\u2318", "K"],
    group: "Command Palette",
  },
  {
    key: "shift+/",
    label: "Shortcuts Reference",
    description: "Open keyboard shortcuts reference",
    display: ["?"],
    group: "Command Palette",
  },

  // Navigation (vim-style go-to sequences)
  {
    key: "g,d",
    label: "Go to Dashboard",
    description: "Navigate to Dashboard",
    display: ["G", "D"],
    group: "Navigation",
  },
  {
    key: "g,b",
    label: "Go to Order Tracking",
    description: "Navigate to Order Tracking",
    display: ["G", "B"],
    group: "Navigation",
  },
  {
    key: "g,u",
    label: "Go to Users",
    description: "Navigate to Users (Admin)",
    display: ["G", "U"],
    group: "Navigation",
  },
  {
    key: "g,a",
    label: "Go to Accounts",
    description: "Navigate to Accounts",
    display: ["G", "A"],
    group: "Navigation",
  },

  // Actions
  {
    key: "mod+b",
    label: "Toggle Sidebar",
    description: "Expand or collapse the sidebar",
    display: ["\u2318", "B"],
    group: "Actions",
  },
  {
    key: "Escape",
    label: "Close",
    description: "Close modal or dialog",
    display: ["Esc"],
    group: "Actions",
  },
]

/** Get shortcuts filtered by group */
export function getShortcutsByGroup(group: ShortcutGroup): ShortcutDefinition[] {
  return SHORTCUTS.filter((s) => s.group === group)
}

/** Get the display string for a shortcut (for Kbd component) */
export function getShortcutDisplay(key: string): string[] | undefined {
  return SHORTCUTS.find((s) => s.key === key)?.display
}
```

2. **Create `apps/web/src/lib/command-items.ts`** - Navigation and action items for the command palette:

```typescript
import type { LucideIcon } from "lucide-react"

export interface CommandItemDef {
  id: string
  label: string
  icon: string          // Lucide icon name (PascalCase, matches navigation.ts pattern)
  shortcut?: string[]   // Display shortcut keys
  group: "navigation" | "actions" | "admin"
  href?: string         // For navigation items
  action?: string       // Action identifier for non-navigation items
  keywords?: string[]   // Extra search keywords for cmdk fuzzy search
  adminOnly?: boolean   // Only show for admin users
}

export const navigationItems: CommandItemDef[] = [
  {
    id: "nav-dashboard",
    label: "Dashboard",
    icon: "Home",
    shortcut: ["G", "D"],
    group: "navigation",
    href: "/admin",
    keywords: ["home", "overview"],
  },
  {
    id: "nav-users",
    label: "Users",
    icon: "Users",
    shortcut: ["G", "U"],
    group: "navigation",
    href: "/admin/users",
    keywords: ["members", "team"],
    adminOnly: true,
  },
  {
    id: "nav-accounts",
    label: "Accounts",
    icon: "Folder",
    shortcut: ["G", "A"],
    group: "navigation",
    href: "/admin/accounts",
    keywords: ["ebay", "manage"],
  },
  {
    id: "nav-order-tracking",
    label: "Order Tracking",
    icon: "BookOpen",
    shortcut: ["G", "B"],
    group: "navigation",
    href: "/admin/order-tracking",
    keywords: ["bookkeeping", "orders", "records"],
  },
  {
    id: "nav-access-profiles",
    label: "Access Profiles",
    icon: "Shield",
    group: "navigation",
    href: "/admin/department-roles",
    keywords: ["roles", "permissions", "departments"],
    adminOnly: true,
  },
  {
    id: "nav-invites",
    label: "Invites",
    icon: "UserPlus",
    group: "navigation",
    href: "/admin/invites",
    keywords: ["invite", "onboard"],
    adminOnly: true,
  },
  {
    id: "nav-automation",
    label: "Extension Hub",
    icon: "Zap",
    group: "navigation",
    href: "/admin/automation",
    keywords: ["extension", "chrome", "agents", "pairing"],
    adminOnly: true,
  },
]

export const actionItems: CommandItemDef[] = [
  {
    id: "action-toggle-sidebar",
    label: "Toggle Sidebar",
    icon: "PanelLeft",
    shortcut: ["\u2318", "B"],
    group: "actions",
    action: "toggle-sidebar",
    keywords: ["collapse", "expand", "menu"],
  },
  {
    id: "action-theme",
    label: "Change Theme",
    icon: "Palette",
    group: "actions",
    action: "open-theme",
    keywords: ["dark", "light", "mode", "color"],
  },
  {
    id: "action-settings",
    label: "Profile Settings",
    icon: "Settings",
    group: "actions",
    action: "open-settings",
    keywords: ["profile", "account", "preferences"],
  },
]
```

Key design decisions:
- Icon names match the PascalCase pattern from navigation.ts (Phase 24 decision)
- Navigation items include all admin routes from navigation.ts
- `adminOnly` flag allows role-based filtering at render time
- `keywords` array enhances cmdk fuzzy search (e.g., searching "bookkeeping" finds "Order Tracking")
- `action` string identifies non-navigation actions for the palette handler
- Navigation uses `/admin` paths (the primary user role); the palette component will adapt paths based on user role
  </action>
  <verify>
Run `npm run build` in apps/web. Verify shortcuts.ts exports SHORTCUTS array and command-items.ts exports navigationItems and actionItems arrays. TypeScript compilation succeeds with no type errors.
  </verify>
  <done>
Shortcuts registry contains all shortcut definitions grouped by Navigation, Actions, Command Palette. Command items define navigation pages and quick actions with Lucide icon names, display shortcuts, and search keywords.
  </done>
</task>

</tasks>

<verification>
1. `pnpm list react-hotkeys-hook cmdk` shows both packages installed
2. `apps/web/src/components/ui/command.tsx` exists and exports Command primitives
3. `apps/web/src/components/ui/kbd.tsx` exists and exports Kbd component
4. `apps/web/src/lib/shortcuts.ts` exports SHORTCUTS, SHORTCUT_GROUPS, getShortcutsByGroup
5. `apps/web/src/lib/command-items.ts` exports navigationItems, actionItems
6. `npm run build` passes with no type errors
</verification>

<success_criteria>
- All dependencies installed and importable
- Shortcut registry is the single source of truth for all keyboard shortcuts
- Command items cover all navigation pages and common actions
- Kbd component renders theme-compatible shortcut badges
- TypeScript types are clean (no any, proper interfaces)
</success_criteria>

<output>
After completion, create `.planning/phases/26-polish-micro-interactions/26-02-SUMMARY.md`
</output>
