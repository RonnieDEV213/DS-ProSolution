---
phase: 26-polish-micro-interactions
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/ui/card.tsx
  - apps/web/src/components/ui/command.tsx
  - apps/web/src/hooks/use-global-shortcuts.ts
  - apps/web/src/components/command-palette/shortcuts-reference.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Card hover shadow jump is clearly visible on standard monitors"
    - "Ctrl+K toggles command palette open and closed"
    - "Command palette scrollbar uses themed thin scrollbar"
    - "Vim-style shortcuts respect role-based access restrictions"
    - "Shortcuts reference modal visually matches command palette dialog"
  artifacts:
    - path: "apps/web/src/components/ui/card.tsx"
      provides: "Enhanced hover shadow elevation"
      contains: "shadow-lg"
    - path: "apps/web/src/hooks/use-global-shortcuts.ts"
      provides: "Toggle behavior and role-filtered vim navigation"
      contains: "!prev"
    - path: "apps/web/src/components/ui/command.tsx"
      provides: "Themed thin scrollbar on command list"
      contains: "scrollbar-thin"
    - path: "apps/web/src/components/command-palette/shortcuts-reference.tsx"
      provides: "Restyled shortcuts modal matching command dialog"
      contains: "bg-popover"
  key_links:
    - from: "apps/web/src/hooks/use-global-shortcuts.ts"
      to: "apps/web/src/lib/command-items.ts"
      via: "navigationItems role filtering"
      pattern: "adminOnly"
---

<objective>
Fix 5 UAT gaps with targeted single-file edits: card hover shadow too subtle, Ctrl+K not toggling, command palette scrollbar unstyled, vim shortcuts ignoring role access, and shortcuts reference modal styling mismatch.

Purpose: Close cosmetic and functional UAT issues from Phase 26 testing -- all are small, isolated fixes in separate files.
Output: 4 files updated with precise fixes, all 5 UAT truths now passing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-polish-micro-interactions/26-01-SUMMARY.md
@.planning/phases/26-polish-micro-interactions/26-05-SUMMARY.md
@apps/web/src/components/ui/card.tsx
@apps/web/src/components/ui/command.tsx
@apps/web/src/hooks/use-global-shortcuts.ts
@apps/web/src/components/command-palette/shortcuts-reference.tsx
@apps/web/src/components/command-palette/command-palette.tsx
@apps/web/src/lib/command-items.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix card shadow, command scrollbar, and Ctrl+K toggle</name>
  <files>
    apps/web/src/components/ui/card.tsx
    apps/web/src/components/ui/command.tsx
    apps/web/src/hooks/use-global-shortcuts.ts
  </files>
  <action>
    Three targeted fixes:

    1. **card.tsx** (line 12): Change `shadow-sm transition-shadow hover:shadow-md` to `shadow-sm transition-shadow hover:shadow-lg`. The jump from shadow-sm to shadow-md is imperceptible (0.05 to 0.1 opacity). shadow-lg provides a clearly visible elevation change while remaining professional.

    2. **command.tsx** (CommandList component, line 93): Add `scrollbar-thin` to the existing className string. Change:
       `"max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto"`
       to:
       `"max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto scrollbar-thin"`
       This matches the 13+ other components in the codebase that use scrollbar-thin for themed scrollbar styling.

    3. **use-global-shortcuts.ts** (line 22): Change `setCommandOpen(true)` to `setCommandOpen(prev => !prev)`. This makes Ctrl+K toggle the command palette open/closed instead of only opening it.
  </action>
  <verify>
    Run `npm run build` from apps/web to confirm no TypeScript or build errors.
    Grep for `hover:shadow-lg` in card.tsx to confirm shadow fix.
    Grep for `scrollbar-thin` in command.tsx to confirm scrollbar fix.
    Grep for `!prev` in use-global-shortcuts.ts to confirm toggle fix.
  </verify>
  <done>
    Card hover shows visible shadow elevation. Command palette scrollbar uses themed thin style. Ctrl+K toggles palette open and closed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add role-based vim shortcut filtering and restyle shortcuts reference modal</name>
  <files>
    apps/web/src/hooks/use-global-shortcuts.ts
    apps/web/src/components/command-palette/shortcuts-reference.tsx
  </files>
  <action>
    Two fixes:

    1. **use-global-shortcuts.ts** -- Add role-based filtering to vim shortcuts to match command palette logic. The command palette (command-palette.tsx lines 73-85) already filters by basePath correctly. Vim shortcuts currently navigate to hardcoded /admin paths without checking role.

       The fix: Update each vim shortcut callback to check whether the target route is accessible for the current basePath.

       For `g,u` (Users - /admin/users): This is adminOnly. The existing code already checks `if (basePath === "/admin")` before navigating. This is correct but incomplete -- a non-admin user pressing G+U should have NO effect (currently it does nothing for VA but may still fire for client). Keep the existing guard.

       For `g,a` (Accounts - /admin/accounts): Accessible to admin and VA but NOT client. Add a guard:
       ```typescript
       useHotkeys("g,a", () => {
         if (basePath === "/client") return
         navigateTo("/admin/accounts")
       }, { enableOnFormTags: false })
       ```

       For `g,b` (Order Tracking - /admin/order-tracking): Accessible to admin and VA but NOT client. Add same guard:
       ```typescript
       useHotkeys("g,b", () => {
         if (basePath === "/client") return
         navigateTo("/admin/order-tracking")
       }, { enableOnFormTags: false })
       ```

       For `g,d` (Dashboard - /admin): Accessible to all roles. Keep as-is (navigateTo handles path adaptation).

       Summary of allowed shortcuts per role:
       - Admin: G+D (dashboard), G+U (users), G+A (accounts), G+B (order-tracking)
       - VA: G+D (dashboard), G+A (accounts), G+B (order-tracking)
       - Client: G+D (dashboard only)

    2. **shortcuts-reference.tsx** -- Restyle to match CommandDialog visual language. The CommandDialog (command.tsx) uses:
       - `overflow-hidden p-0` on DialogContent
       - `bg-popover text-popover-foreground` on Command wrapper
       - `text-xs font-medium` for group headings
       - `max-h-[300px]` for content

       ShortcutsReference currently uses:
       - `sm:max-w-lg bg-card` on DialogContent
       - `text-sm font-semibold` for group headings
       - `max-h-[60vh]` for scrollable area
       - `space-y-6 pr-2` layout

       Update shortcuts-reference.tsx to align:
       - Change DialogContent className to: `sm:max-w-lg overflow-hidden p-0 bg-popover text-popover-foreground border-border`
       - Move DialogHeader inside (keep visible, not sr-only -- this modal needs visible title unlike command palette)
       - Add padding to DialogHeader: `px-4 pt-4 pb-2`
       - Change scrollable div to: `px-4 pb-4 space-y-4 max-h-[60vh] overflow-y-auto scrollbar-thin`
       - Change group heading h4 from `text-sm font-semibold text-foreground mb-3` to `text-xs font-medium text-muted-foreground mb-2 uppercase tracking-wider` to match command group heading style
       - Keep the grid layout (it works well for shortcuts) but use `gap-y-2 gap-x-4` (remove the 2.5)
       - The bg-popover + text-popover-foreground matches command dialog context. Keep scrollbar-thin on scrollable area.
  </action>
  <verify>
    Run `npm run build` from apps/web to confirm no TypeScript or build errors.
    Grep for `basePath === "/client"` in use-global-shortcuts.ts to confirm role guards.
    Grep for `bg-popover` in shortcuts-reference.tsx to confirm restyling.
    Grep for `uppercase tracking-wider` in shortcuts-reference.tsx to confirm group heading style.
  </verify>
  <done>
    Vim shortcuts G+A and G+B blocked for client role; G+U blocked for non-admin (already was). Shortcuts reference modal uses popover background, smaller group headers with uppercase tracking, and consistent styling matching command palette dialog.
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes in apps/web with zero errors
- Card component has `hover:shadow-lg` (not shadow-md)
- CommandList has `scrollbar-thin` class
- Ctrl+K handler uses toggle pattern `prev => !prev`
- Vim shortcuts check basePath before navigating to restricted routes
- ShortcutsReference uses `bg-popover` and `text-xs font-medium` group headers
</verification>

<success_criteria>
All 5 UAT truths addressed:
1. Card hover shadow clearly visible (shadow-lg jump)
2. Ctrl+K toggles command palette open/closed
3. Command palette scrollbar uses themed thin style
4. Vim shortcuts respect role restrictions (no 404 navigation)
5. Shortcuts modal matches command palette visual language
</success_criteria>

<output>
After completion, create `.planning/phases/26-polish-micro-interactions/26-07-SUMMARY.md`
</output>
