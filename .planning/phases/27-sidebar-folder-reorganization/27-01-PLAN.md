---
phase: 27-sidebar-folder-reorganization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/types/navigation.ts
  - apps/web/src/lib/navigation.ts
autonomous: true

must_haves:
  truths:
    - "SidebarSection interface defines id, label, icon, items, and roles fields"
    - "Navigation configs export grouped sections per role (admin, va, client) with dashboardNavItem separate"
    - "getVisibleSections utility filters sections by role and returns only sections the role can see"
    - "Extension Hub is renamed to Automation Hub in navigation config"
    - "Access Profiles and Invites are removed from sidebar navigation items"
  artifacts:
    - path: "apps/web/src/types/navigation.ts"
      provides: "SidebarSection interface alongside existing NavItem"
      contains: "SidebarSection"
    - path: "apps/web/src/lib/navigation.ts"
      provides: "Grouped sidebar sections, dashboardNavItem, getVisibleSections"
      exports: ["adminSidebarSections", "vaSidebarSections", "clientSidebarSections", "dashboardNavItem", "getVisibleSections"]
  key_links:
    - from: "apps/web/src/lib/navigation.ts"
      to: "apps/web/src/types/navigation.ts"
      via: "import SidebarSection type"
      pattern: "import.*SidebarSection.*from.*types/navigation"
---

<objective>
Restructure the navigation configuration from flat NavItem arrays to grouped SidebarSection structures with role-based visibility metadata.

Purpose: Foundation for collapsible sidebar sections. All downstream plans (AppSidebar, layouts, command palette) depend on this new grouped structure.
Output: Updated types/navigation.ts with SidebarSection interface, updated lib/navigation.ts with grouped section configs and filtering utility.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/types/navigation.ts
@apps/web/src/lib/navigation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SidebarSection interface to navigation types</name>
  <files>apps/web/src/types/navigation.ts</files>
  <action>
Add a `SidebarSection` interface to the existing navigation types file. Keep the existing `NavItem` interface unchanged.

```typescript
export interface SidebarSection {
  id: string                              // Cookie key: sidebar:section:{id}
  label: string                           // Display name in sidebar
  icon: string                            // Lucide icon name (PascalCase)
  items: NavItem[]                        // Nav items within this section
  roles: ("admin" | "va" | "client")[]   // Which roles see this section
}
```

Do NOT remove or modify the existing NavItem interface.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit` from apps/web</verify>
  <done>SidebarSection interface exists in types/navigation.ts alongside NavItem, with all 5 required fields (id, label, icon, items, roles)</done>
</task>

<task type="auto">
  <name>Task 2: Restructure navigation.ts from flat arrays to grouped sections</name>
  <files>apps/web/src/lib/navigation.ts</files>
  <action>
Replace the flat `adminNavItems`, `vaNavItems`, and `clientNavItems` arrays with a grouped section structure. Import `SidebarSection` from `@/types/navigation`.

**Dashboard nav item (above sections, always visible):**
```typescript
export const dashboardNavItem = (basePath: string): NavItem => ({
  href: basePath,
  label: "Dashboard",
  icon: "Home",
})
```

**Admin sidebar sections:**
```typescript
export const adminSidebarSections: SidebarSection[] = [
  {
    id: "admin",
    label: "Admin",
    icon: "ShieldCheck",
    items: [
      { href: "/admin/users", label: "Users", icon: "Users" },
      // Access Profiles and Invites REMOVED — now modals on Users page
    ],
    roles: ["admin"],
  },
  {
    id: "monitoring",
    label: "Monitoring",
    icon: "Activity",
    items: [
      { href: "/admin/accounts", label: "Accounts", icon: "Folder" },
      { href: "/admin/order-tracking", label: "Order Tracking", icon: "BookOpen" },
    ],
    roles: ["admin", "va", "client"],
  },
  {
    id: "automation",
    label: "Automation Hub",   // Renamed from "Extension Hub"
    icon: "Zap",
    items: [
      { href: "/admin/automation", label: "Collection", icon: "Zap" },
      // Jobs: future item, not included yet
    ],
    roles: ["admin", "va"],
  },
]
```

**VA sidebar sections:** Same structure but with VA-specific base paths:
```typescript
export const vaSidebarSections: SidebarSection[] = [
  {
    id: "monitoring",
    label: "Monitoring",
    icon: "Activity",
    items: [
      { href: "/va/accounts", label: "Accounts", icon: "Building2" },
      { href: "/va/order-tracking", label: "Order Tracking", icon: "BookOpen" },
    ],
    roles: ["admin", "va", "client"],
  },
  // VA does not see Admin section
  // VA may see Automation Hub depending on access profile (add if VA has automation routes)
]
```

**Client sidebar sections:** Client only sees Monitoring:
```typescript
export const clientSidebarSections: SidebarSection[] = [
  {
    id: "monitoring",
    label: "Monitoring",
    icon: "Activity",
    items: [
      // Client currently has no monitoring pages exposed — add as features become available
    ],
    roles: ["admin", "va", "client"],
  },
]
```

Note: Client currently only has Dashboard. The empty monitoring section will be hidden by getVisibleSections since it has no items. Keep clientSidebarSections as an empty array `[]` if no sections have items.

**Filtering utility:**
```typescript
export function getVisibleSections(
  sections: SidebarSection[],
  role: "admin" | "va" | "client"
): SidebarSection[] {
  return sections
    .filter(section => section.roles.includes(role))
    .filter(section => section.items.length > 0)  // Hide empty sections
}
```

**IMPORTANT:** Keep the old flat exports (`adminNavItems`, `vaNavItems`, `clientNavItems`) temporarily as deprecated aliases so the build doesn't break before Plan 05 updates the consumers. These can be computed from the sections:

```typescript
/** @deprecated Use adminSidebarSections + dashboardNavItem instead */
export const adminNavItems: NavItem[] = [
  dashboardNavItem("/admin"),
  ...adminSidebarSections.flatMap(s => s.items),
]

/** @deprecated Use vaSidebarSections + dashboardNavItem instead */
export const vaNavItems: NavItem[] = [
  dashboardNavItem("/va"),
  ...vaSidebarSections.flatMap(s => s.items),
]

/** @deprecated Use clientSidebarSections + dashboardNavItem instead */
export const clientNavItems: NavItem[] = [
  dashboardNavItem("/client"),
]
```

This ensures the existing layouts, command palette, and breadcrumb continue to work until they're updated in later plans.
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit` from apps/web
2. Dev server starts without errors: `npm run dev` (check for import errors)
3. Verify deprecated exports still work by checking the running app sidebar renders correctly
  </verify>
  <done>
- navigation.ts exports: dashboardNavItem, adminSidebarSections, vaSidebarSections, clientSidebarSections, getVisibleSections
- Deprecated flat exports still work (adminNavItems, vaNavItems, clientNavItems)
- "Extension Hub" renamed to "Automation Hub" in section label
- Access Profiles and Invites removed from nav items
- TypeScript compiles cleanly
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in apps/web
2. `npm run dev` starts without errors
3. Existing sidebar still renders (deprecated exports provide backward compatibility)
4. SidebarSection type is importable from @/types/navigation
5. getVisibleSections correctly filters by role and hides empty sections
</verification>

<success_criteria>
- SidebarSection interface exists with id, label, icon, items, roles fields
- Navigation configs export grouped sections for admin, VA, and client
- getVisibleSections utility filters and hides empty sections
- Deprecated flat exports maintain backward compatibility
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/27-sidebar-folder-reorganization/27-01-SUMMARY.md`
</output>
