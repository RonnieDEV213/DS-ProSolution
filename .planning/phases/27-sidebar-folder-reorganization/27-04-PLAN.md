---
phase: 27-sidebar-folder-reorganization
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/profile/profile-settings-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "Sync status section appears in the Profile Settings General/Profile tab"
    - "Sync status shows current sync state, last sync time, and manual sync trigger"
    - "Sync status section renders at the bottom of the Profile tab content"
  artifacts:
    - path: "apps/web/src/components/profile/profile-settings-dialog.tsx"
      provides: "Profile Settings dialog with sync status in Profile tab"
      contains: "SyncStatusSection"
  key_links:
    - from: "apps/web/src/components/profile/profile-settings-dialog.tsx"
      to: "apps/web/src/hooks/sync/use-sync-status.ts"
      via: "useSyncStatus hook for sync state"
      pattern: "useSyncStatus"
---

<objective>
Move sync status from the sidebar footer into the Profile Settings dialog as a section within the Profile tab.

Purpose: Declutter the sidebar footer (which should only have Profile Settings button + collapse toggle). Sync status is an informational display that belongs in settings, not persistent sidebar chrome.
Output: Updated Profile Settings dialog with a "Sync Status" section in the Profile tab.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@apps/web/src/components/profile/profile-settings-dialog.tsx
@apps/web/src/components/profile/profile-tab.tsx
@apps/web/src/components/sync/sync-status-indicator.tsx
@apps/web/src/hooks/sync/use-sync-status.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SyncStatusSection component for Profile Settings</name>
  <files>apps/web/src/components/profile/profile-settings-dialog.tsx</files>
  <action>
Read `apps/web/src/components/profile/profile-tab.tsx` first to understand the Profile tab layout. Then read `apps/web/src/hooks/sync/use-sync-status.ts` to understand the sync status hook interface.

Create an inline `SyncStatusSection` component (inside profile-settings-dialog.tsx or as a small helper at the top of the file) that displays sync status information. This component does NOT use the `useSidebar` hook (unlike SyncStatusIndicator which does) — it's a standalone section.

```typescript
function SyncStatusSection() {
  const { status, pendingCount, lastSyncAt, error, retry } = useSyncStatus();

  return (
    <div className="border-t border-border pt-6 mt-6">
      <h3 className="text-sm font-medium mb-3">Sync Status</h3>
      <div className="space-y-3">
        {/* Status indicator */}
        <div className="flex items-center gap-2">
          {status === "idle" && (
            <>
              <div className="h-2 w-2 rounded-full bg-green-500" />
              <span className="text-sm text-muted-foreground">Synced</span>
            </>
          )}
          {status === "syncing" && (
            <>
              <Loader2 className="h-4 w-4 animate-spin text-blue-400" />
              <span className="text-sm text-muted-foreground">
                Syncing{pendingCount > 0 ? ` ${pendingCount} records` : "..."}
              </span>
            </>
          )}
          {status === "error" && (
            <>
              <AlertCircle className="h-4 w-4 text-red-400" />
              <span className="text-sm text-red-400">{error || "Sync failed"}</span>
              <Button variant="ghost" size="sm" onClick={retry} className="ml-auto h-7 text-xs">
                <RefreshCw className="h-3 w-3 mr-1" />
                Retry
              </Button>
            </>
          )}
          {status === "offline" && (
            <>
              <CloudOff className="h-4 w-4 text-yellow-400" />
              <span className="text-sm text-yellow-400">Offline</span>
            </>
          )}
        </div>

        {/* Last synced timestamp */}
        {lastSyncAt && (
          <p className="text-xs text-muted-foreground">
            Last synced {formatDistanceToNow(lastSyncAt, { addSuffix: true })}
          </p>
        )}
      </div>
    </div>
  );
}
```

Import additional icons: `Loader2`, `AlertCircle`, `RefreshCw`, `CloudOff` from lucide-react.
Import `useSyncStatus` from `@/hooks/sync/use-sync-status`.
Import `formatDistanceToNow` from `date-fns`.
Import `Button` from `@/components/ui/button`.

Then update the profile-settings-dialog.tsx to render `<SyncStatusSection />` after the Profile tab content. Specifically, in the Profile tab rendering section (where `activeTab === "profile"` renders `<ProfileTab />`), add the sync status section below it:

```tsx
{activeTab === "profile" && (
  <>
    <ProfileTab
      displayName={userData.displayName}
      email={userData.email}
      role={userData.role}
    />
    <SyncStatusSection />
  </>
)}
```

This places the sync status as a bottom section of the Profile tab, separated by a border-t divider.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Open Profile Settings dialog — Profile tab shows sync status section at the bottom
3. Sync status displays current state (idle shows "Synced", etc.)
4. Last synced timestamp displays when available
5. Error state shows retry button
  </verify>
  <done>
- SyncStatusSection renders inside Profile tab of Profile Settings dialog
- Shows sync state with appropriate icon and text
- Shows last synced timestamp
- Error state includes retry button
- All existing Profile Settings functionality preserved
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Profile Settings dialog Profile tab shows sync status section
3. Sync status is informational and correctly reflects sync state
4. No changes to other tabs (Security, Extension, Theme)
</verification>

<success_criteria>
- Sync status section visible in Profile Settings Profile tab
- Displays sync state, last synced time, and retry for errors
- Existing Profile Settings functionality unaffected
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/27-sidebar-folder-reorganization/27-04-SUMMARY.md`
</output>
