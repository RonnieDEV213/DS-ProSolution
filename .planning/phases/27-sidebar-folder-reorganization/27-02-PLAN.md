---
phase: 27-sidebar-folder-reorganization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/admin/access-profiles-modal.tsx
  - apps/web/src/components/admin/invites-modal.tsx
  - apps/web/src/app/admin/users/page.tsx
autonomous: true

must_haves:
  truths:
    - "Access Profiles modal opens from toolbar button on Users page"
    - "Invites modal opens from toolbar button on Users page"
    - "Access Profiles modal displays the full DepartmentRolesTable content"
    - "Invites modal displays the full InvitesList with create invite capability"
    - "Both modals can be open/closed independently without affecting Users page state"
    - "Changes made in modals (role updates, invites created) refresh the Users table"
  artifacts:
    - path: "apps/web/src/components/admin/access-profiles-modal.tsx"
      provides: "Dialog wrapper around DepartmentRolesTable"
      exports: ["AccessProfilesModal"]
    - path: "apps/web/src/components/admin/invites-modal.tsx"
      provides: "Dialog wrapper around InvitesList with InviteDialog"
      exports: ["InvitesModal"]
    - path: "apps/web/src/app/admin/users/page.tsx"
      provides: "Users page with toolbar buttons for Access Profiles and Invites modals"
      contains: "AccessProfilesModal"
  key_links:
    - from: "apps/web/src/app/admin/users/page.tsx"
      to: "apps/web/src/components/admin/access-profiles-modal.tsx"
      via: "state-controlled Dialog open prop"
      pattern: "accessProfilesOpen"
    - from: "apps/web/src/components/admin/access-profiles-modal.tsx"
      to: "apps/web/src/components/admin/department-roles-table.tsx"
      via: "renders DepartmentRolesTable inside Dialog"
      pattern: "DepartmentRolesTable"
---

<objective>
Consolidate Access Profiles and Invites pages into modals accessible from toolbar buttons on the Users page.

Purpose: Reduce sidebar clutter by removing standalone nav items for Access Profiles and Invites. Users page becomes the single admin entry point for user management, access profiles, and invitations.
Output: Two new modal components (AccessProfilesModal, InvitesModal) and an updated Users page with toolbar buttons.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@apps/web/src/app/admin/users/page.tsx
@apps/web/src/app/admin/department-roles/page.tsx
@apps/web/src/app/admin/invites/page.tsx
@apps/web/src/components/admin/department-roles-table.tsx
@apps/web/src/components/admin/invites-list.tsx
@apps/web/src/components/admin/invite-dialog.tsx
@apps/web/src/components/layout/page-header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AccessProfilesModal and InvitesModal components</name>
  <files>
    apps/web/src/components/admin/access-profiles-modal.tsx
    apps/web/src/components/admin/invites-modal.tsx
  </files>
  <action>
**AccessProfilesModal** — Extract logic from `department-roles/page.tsx` into a Dialog wrapper:

```typescript
"use client";

import { useState, useEffect } from "react";
import { createClient } from "@/lib/supabase/client";
import {
  Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription,
} from "@/components/ui/dialog";
import { DepartmentRolesTable } from "@/components/admin/department-roles-table";
import { TableSkeleton } from "@/components/skeletons/table-skeleton";

const DEFAULT_ORG_ID = "a0000000-0000-0000-0000-000000000001";

interface AccessProfilesModalProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onRoleUpdated?: () => void;
}

export function AccessProfilesModal({ open, onOpenChange, onRoleUpdated }: AccessProfilesModalProps) {
  const [orgId, setOrgId] = useState<string | null>(null);
  const [refreshTrigger, setRefreshTrigger] = useState(0);

  useEffect(() => {
    if (open) {
      // Reset state and fetch org ID when modal opens
      const fetchOrgId = async () => {
        const supabase = createClient();
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
          setOrgId(DEFAULT_ORG_ID);
        }
      };
      fetchOrgId();
    }
  }, [open]);

  const handleRoleUpdated = () => {
    setRefreshTrigger((prev) => prev + 1);
    onRoleUpdated?.();
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-5xl max-h-[80vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Access Profiles</DialogTitle>
          <DialogDescription>
            Create and manage access profiles for VAs. Each profile can have specific permissions.
          </DialogDescription>
        </DialogHeader>
        {orgId ? (
          <DepartmentRolesTable
            orgId={orgId}
            refreshTrigger={refreshTrigger}
            onRoleUpdated={handleRoleUpdated}
          />
        ) : (
          <TableSkeleton columns={6} rows={5} />
        )}
      </DialogContent>
    </Dialog>
  );
}
```

**InvitesModal** — Extract logic from `invites/page.tsx` into a Dialog wrapper:

```typescript
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import {
  Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription,
} from "@/components/ui/dialog";
import { InviteDialog } from "@/components/admin/invite-dialog";
import { InvitesList } from "@/components/admin/invites-list";

interface InvitesModalProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onInviteCreated?: () => void;
}

export function InvitesModal({ open, onOpenChange, onInviteCreated }: InvitesModalProps) {
  const [inviteDialogOpen, setInviteDialogOpen] = useState(false);
  const [refreshTrigger, setRefreshTrigger] = useState(0);

  const handleInviteCreated = () => {
    setRefreshTrigger((prev) => prev + 1);
    onInviteCreated?.();
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
        <DialogHeader>
          <div className="flex items-center justify-between">
            <div>
              <DialogTitle>Manage Invites</DialogTitle>
              <DialogDescription>
                Create and manage user invitations
              </DialogDescription>
            </div>
            <Button onClick={() => setInviteDialogOpen(true)}>Invite</Button>
          </div>
        </DialogHeader>
        <InvitesList refreshTrigger={refreshTrigger} />
        <InviteDialog
          open={inviteDialogOpen}
          onOpenChange={setInviteDialogOpen}
          onInviteCreated={handleInviteCreated}
        />
      </DialogContent>
    </Dialog>
  );
}
```

Both modals follow the existing Dialog pattern from the codebase. Use `max-w-5xl` for Access Profiles (wider table) and `max-w-4xl` for Invites. Both use `max-h-[80vh] overflow-y-auto` for scrolling.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit` from apps/web</verify>
  <done>AccessProfilesModal and InvitesModal components exist, each wrapping the existing table/list components inside a Dialog</done>
</task>

<task type="auto">
  <name>Task 2: Add toolbar buttons and modal integration to Users page</name>
  <files>apps/web/src/app/admin/users/page.tsx</files>
  <action>
Update the Users page to include toolbar buttons that open the Access Profiles and Invites modals.

Add state for both modals. Add `Shield` and `UserPlus` icon imports from lucide-react. Import both modal components.

Use the existing PageHeader `actions` prop to render two `Button variant="outline"` elements:
- "Access Profiles" button with Shield icon — opens AccessProfilesModal
- "Invites" button with UserPlus icon — opens InvitesModal

Add a `handleUserUpdated` callback that increments refreshTrigger. Pass `onRoleUpdated` to AccessProfilesModal and `onInviteCreated` to InvitesModal, both calling handleUserUpdated so the users table refreshes when changes are made in the modals.

Render both modal components at the bottom of the JSX, after UsersTable.

Keep the existing search input and UsersTable as-is.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Visit /admin/users — two toolbar buttons appear: "Access Profiles" and "Invites"
3. Click "Access Profiles" — modal opens with DepartmentRolesTable
4. Click "Invites" — modal opens with InvitesList and invite button
5. Both modals close cleanly without affecting the Users table
  </verify>
  <done>
- Users page shows "Access Profiles" and "Invites" buttons in the page header
- Clicking each button opens the respective modal
- Modals display full content from the consolidated pages
- Changes in modals refresh the Users table
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. /admin/users page renders with toolbar buttons
3. AccessProfilesModal opens and shows DepartmentRolesTable
4. InvitesModal opens and shows InvitesList with Invite button
5. Both modals close without issues
6. No existing pages broken (department-roles/page.tsx and invites/page.tsx still work — they'll be cleaned up later if needed)
</verification>

<success_criteria>
- Two new modal components created (access-profiles-modal.tsx, invites-modal.tsx)
- Users page has toolbar buttons for both modals
- Modal content matches original standalone pages
- Modal open/close works independently
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/27-sidebar-folder-reorganization/27-02-SUMMARY.md`
</output>
