---
phase: 04.1-auto-order-tab-organization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/api/src/app/permissions.py
  - apps/web/src/components/admin/department-role-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "auto_order.read permission key is valid for department roles"
    - "Admin can assign auto_order.read to a department role via UI"
    - "Permission appears under Ordering Permissions category"
  artifacts:
    - path: "apps/api/src/app/permissions.py"
      provides: "auto_order.read in DEPT_ROLE_PERMISSION_KEYS"
      contains: "auto_order.read"
    - path: "apps/web/src/components/admin/department-role-dialog.tsx"
      provides: "auto_order.read in AVAILABLE_PERMISSIONS"
      contains: "auto_order.read"
  key_links:
    - from: "department-role-dialog.tsx"
      to: "permissions.py"
      via: "permission key string match"
      pattern: "auto_order\\.read"
---

<objective>
Add the `auto_order.read` permission to enable RBAC for the Auto Order extension tab.

Purpose: VAs need this permission assigned via department roles to see the Auto Order tab in the extension. Without this permission key defined, admins cannot grant Auto Order access.

Output: Permission key added to backend validation and frontend UI.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04.1-auto-order-tab-organization/04.1-CONTEXT.md

@apps/api/src/app/permissions.py
@apps/web/src/components/admin/department-role-dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto_order.read permission to backend</name>
  <files>apps/api/src/app/permissions.py</files>
  <action>
Add `auto_order.read` permission to the permissions system:

1. Add to `DEPT_ROLE_PERMISSION_KEYS` set (around line 8):
   - Add "auto_order.read" after the accounts.view entry
   - Add a comment: "# Auto Order - extension tab access"

2. Add to `PERMISSION_LABELS` dict (around line 69):
   - Add: "auto_order.read": "Auto Order Tab"

This follows the existing pattern - permission keys use dot notation (category.action).
  </action>
  <verify>
Run: `cd /mnt/c/Users/User/Downloads/GitRepos/DS-ProSolution/apps/api && python -c "from app.permissions import DEPT_ROLE_PERMISSION_KEYS, PERMISSION_LABELS; assert 'auto_order.read' in DEPT_ROLE_PERMISSION_KEYS; assert 'auto_order.read' in PERMISSION_LABELS; print('OK')"`
  </verify>
  <done>auto_order.read exists in DEPT_ROLE_PERMISSION_KEYS and PERMISSION_LABELS</done>
</task>

<task type="auto">
  <name>Task 2: Add auto_order.read to department role dialog</name>
  <files>apps/web/src/components/admin/department-role-dialog.tsx</files>
  <action>
Add `auto_order.read` to the AVAILABLE_PERMISSIONS array in department-role-dialog.tsx:

1. Find the AVAILABLE_PERMISSIONS array (around line 33)

2. Add a new entry in the "Ordering Permissions" group, at the START of the group (before order_tracking.read):
   ```typescript
   { key: "auto_order.read", label: "Auto Order Tab", group: "Ordering Permissions" },
   ```

Rationale: Auto Order is the primary automation feature, so it should appear first in Ordering Permissions.
  </action>
  <verify>
Run: `grep -n "auto_order.read" /mnt/c/Users/User/Downloads/GitRepos/DS-ProSolution/apps/web/src/components/admin/department-role-dialog.tsx`
  </verify>
  <done>auto_order.read appears in AVAILABLE_PERMISSIONS under Ordering Permissions group</done>
</task>

</tasks>

<verification>
After both tasks:
1. Backend has auto_order.read in permission validation
2. Frontend dialog shows Auto Order Tab checkbox under Ordering Permissions
3. Changes are minimal - only adding new permission, not modifying existing ones
</verification>

<success_criteria>
- auto_order.read is a valid permission key that can be assigned to department roles
- Permission appears in department role dialog under "Ordering Permissions"
- No other permissions or behavior changed
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-auto-order-tab-organization/04.1-01-SUMMARY.md`
</output>
