---
phase: 33-collection-keyboard-shortcuts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/lib/shortcuts.ts
  - apps/web/src/lib/storage-keys.ts
  - apps/web/src/components/command-palette/shortcuts-reference.tsx
autonomous: true

must_haves:
  truths:
    - "Shortcuts reference (? key) shows collection-specific shortcuts only when on the collection page (/admin/automation)"
    - "Shortcuts reference shows global shortcuts on all pages"
    - "Collection shortcuts group is hidden when NOT on the collection page"
    - "SHORTCUTS registry contains all collection shortcut definitions with scope: collection"
  artifacts:
    - path: "apps/web/src/lib/shortcuts.ts"
      provides: "Collection shortcut definitions in SHORTCUTS array, Collection group in SHORTCUT_GROUPS"
      contains: "scope: \"collection\""
    - path: "apps/web/src/lib/storage-keys.ts"
      provides: "COLLECTION_SHORTCUTS_HINT_DISMISSED storage key"
      contains: "COLLECTION_SHORTCUTS_HINT_DISMISSED"
    - path: "apps/web/src/components/command-palette/shortcuts-reference.tsx"
      provides: "Page-contextual shortcut filtering by pathname"
      contains: "usePathname"
  key_links:
    - from: "apps/web/src/components/command-palette/shortcuts-reference.tsx"
      to: "apps/web/src/lib/shortcuts.ts"
      via: "import SHORTCUTS, SHORTCUT_GROUPS + filter by scope"
      pattern: "s\\.scope.*activeScope"
---

<objective>
Extend the keyboard shortcuts registry with collection-specific shortcut definitions and make the ShortcutsReference dialog page-contextual so it only shows collection shortcuts when the user is on the collection page.

Purpose: Infrastructure for collection keyboard shortcuts. The registry and reference dialog must be scope-aware before the shortcuts hook can be wired in Plan 02.
Output: Updated shortcuts.ts with collection entries, page-contextual ShortcutsReference, and a localStorage key for the first-visit hint.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-collection-keyboard-shortcuts/33-CONTEXT.md
@.planning/phases/33-collection-keyboard-shortcuts/33-RESEARCH.md

Source files:
@apps/web/src/lib/shortcuts.ts
@apps/web/src/lib/storage-keys.ts
@apps/web/src/components/command-palette/shortcuts-reference.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend shortcuts registry with collection shortcuts and storage key</name>
  <files>apps/web/src/lib/shortcuts.ts, apps/web/src/lib/storage-keys.ts</files>
  <action>
1. In `shortcuts.ts`, add `"Collection"` to the `SHORTCUT_GROUPS` array (after "Actions", before any closing).

2. Add the following collection shortcut definitions to the `SHORTCUTS` array. Each MUST have `scope: "collection"`:

```
// Collection (page-scoped)
{ key: "Delete", label: "Delete Selected", description: "Delete selected sellers", display: ["Del"], group: "Collection", scope: "collection" }
{ key: "f", label: "Flag Selected", description: "Toggle flag on selected sellers", display: ["F"], group: "Collection", scope: "collection" }
{ key: "e", label: "Export", description: "Export sellers (selection-scoped if any selected)", display: ["E"], group: "Collection", scope: "collection" }
{ key: "s", label: "Start Run", description: "Open run configuration dialog", display: ["S"], group: "Collection", scope: "collection" }
{ key: "Escape", label: "Clear Selection", description: "Clear seller selection", display: ["Esc"], group: "Collection", scope: "collection" }
{ key: "mod+z", label: "Undo Delete", description: "Undo last bulk delete", display: ["\u2318", "Z"], group: "Collection", scope: "collection" }
{ key: "mod+a", label: "Select All", description: "Select all visible sellers", display: ["\u2318", "A"], group: "Collection", scope: "collection" }
{ key: "mod+c", label: "Copy Selected", description: "Copy selected seller names to clipboard", display: ["\u2318", "C"], group: "Collection", scope: "collection" }
```

3. In `storage-keys.ts`, add `COLLECTION_SHORTCUTS_HINT_DISMISSED: "dspro:collection_shortcuts_hint_dismissed"` to the `STORAGE_KEYS` object.

IMPORTANT: Do NOT modify the existing global shortcuts entries (they stay as-is). The collection `f` and `e` entries are scoped and will only display when on the collection page. The global `f` (Filter) and `e` (Export) and `Escape` (Close) entries remain unscoped (global).
  </action>
  <verify>
Run `cd /mnt/c/Users/User/Downloads/GitRepos/DS-ProSolution/apps/web && npx tsc --noEmit` to confirm no type errors. Verify the `SHORTCUT_GROUPS` array includes "Collection". Verify all 8 collection shortcuts have `scope: "collection"`.
  </verify>
  <done>
SHORTCUTS array contains 8 collection-scoped entries in a "Collection" group. STORAGE_KEYS has the hint dismissed key. TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Make ShortcutsReference dialog page-contextual</name>
  <files>apps/web/src/components/command-palette/shortcuts-reference.tsx</files>
  <action>
Modify `ShortcutsReference` to filter shortcuts by the current page scope:

1. Add `import { usePathname } from "next/navigation"` at the top.

2. Inside the component, add:
```typescript
const pathname = usePathname();
const activeScope = pathname?.includes("/automation") ? "collection" : undefined;
```

3. Change the `SHORTCUT_GROUPS.map()` loop to filter shortcuts by scope. Replace the existing filter:
```typescript
const groupShortcuts = SHORTCUTS.filter((s) => s.group === group)
```
with:
```typescript
const groupShortcuts = SHORTCUTS.filter(
  (s) => s.group === group && (!s.scope || s.scope === activeScope)
)
```

This ensures:
- Global shortcuts (no `scope` field) always show on every page
- Collection shortcuts (`scope: "collection"`) only show when pathname includes "/automation"
- The "Collection" group heading is hidden when not on the collection page (the existing `if (groupShortcuts.length === 0) return null` handles this)

4. Update the `ShortcutGroup` type: Since `SHORTCUT_GROUPS` now includes "Collection", the type auto-updates via `typeof SHORTCUT_GROUPS[number]`. No manual type change needed.

Do NOT touch the command palette (`command-palette.tsx` or `command-items.ts`). Per CONTEXT.md, Cmd+K stays navigation-only.
  </action>
  <verify>
Run `cd /mnt/c/Users/User/Downloads/GitRepos/DS-ProSolution/apps/web && npx tsc --noEmit`. Then run `npm run build` to verify the page compiles with the new `usePathname` import (must be in a client component -- it already has "use client" directive).
  </verify>
  <done>
ShortcutsReference filters shortcuts by scope. On /admin/automation, the "Collection" group with 8 shortcuts appears. On other pages, only global shortcuts (Navigation, Actions, Command Palette) appear. Build passes.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit` passes
2. Build succeeds: `npm run build` passes
3. Manual check: `shortcuts.ts` has "Collection" in SHORTCUT_GROUPS and 8 scoped entries
4. Manual check: `shortcuts-reference.tsx` uses `usePathname` and filters by `activeScope`
5. Manual check: `storage-keys.ts` has `COLLECTION_SHORTCUTS_HINT_DISMISSED`
</verification>

<success_criteria>
- SHORTCUTS registry contains 8 collection-scoped shortcut definitions
- SHORTCUT_GROUPS includes "Collection"
- ShortcutsReference dialog filters by page scope using pathname
- Collection group only visible when on /admin/automation
- STORAGE_KEYS includes hint dismissed key
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/33-collection-keyboard-shortcuts/33-01-SUMMARY.md`
</output>
