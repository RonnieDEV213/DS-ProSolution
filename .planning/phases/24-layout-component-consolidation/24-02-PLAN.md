---
phase: 24-layout-component-consolidation
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - apps/web/src/components/layout/app-sidebar.tsx
  - apps/web/src/components/layout/breadcrumb-nav.tsx
  - apps/web/src/components/layout/page-header.tsx
autonomous: true

must_haves:
  truths:
    - "AppSidebar renders navigation items from navItems prop using Lucide React icons"
    - "AppSidebar includes theme toggle popover with ThemePickerCompact in footer (preserving Phase 23 functionality)"
    - "AppSidebar includes Profile Settings button that opens ProfileSettingsDialog"
    - "AppSidebar supports optional SyncStatusIndicator via showSyncStatus prop"
    - "BreadcrumbNav dynamically generates breadcrumbs from current pathname using usePathname"
    - "BreadcrumbNav hides on dashboard root pages (single segment paths)"
    - "PageHeader provides consistent title, optional description, and optional action buttons"
  artifacts:
    - path: "apps/web/src/components/layout/app-sidebar.tsx"
      provides: "Unified sidebar component accepting navItems, dashboardTitle, showSyncStatus props"
      exports: ["AppSidebar"]
    - path: "apps/web/src/components/layout/breadcrumb-nav.tsx"
      provides: "Dynamic breadcrumb navigation from Next.js route segments"
      exports: ["BreadcrumbNav"]
    - path: "apps/web/src/components/layout/page-header.tsx"
      provides: "Consistent page header with title, description, actions"
      exports: ["PageHeader"]
  key_links:
    - from: "apps/web/src/components/layout/app-sidebar.tsx"
      to: "apps/web/src/components/ui/sidebar.tsx"
      via: "imports Sidebar, SidebarContent, SidebarHeader, SidebarFooter, SidebarMenu, SidebarMenuItem, SidebarMenuButton"
      pattern: "from.*@/components/ui/sidebar"
    - from: "apps/web/src/components/layout/app-sidebar.tsx"
      to: "apps/web/src/types/navigation.ts"
      via: "imports NavItem type"
      pattern: "import.*NavItem"
    - from: "apps/web/src/components/layout/app-sidebar.tsx"
      to: "apps/web/src/components/profile/theme-picker.tsx"
      via: "imports ThemePickerCompact for sidebar footer theme popover"
      pattern: "ThemePickerCompact"
    - from: "apps/web/src/components/layout/breadcrumb-nav.tsx"
      to: "apps/web/src/components/ui/breadcrumb.tsx"
      via: "imports Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbPage, BreadcrumbSeparator"
      pattern: "from.*@/components/ui/breadcrumb"
---

<objective>
Create the three core layout components: AppSidebar (unified sidebar replacing 3 duplicates), BreadcrumbNav (dynamic route-based breadcrumbs), and PageHeader (consistent page title pattern).

Purpose: These components are the reusable layout primitives that all three dashboard layouts (Admin, VA, Client) will use, eliminating ~350 lines of duplicated sidebar code and establishing consistent navigation patterns.
Output: 3 new layout components in `components/layout/` ready for integration into layouts.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-layout-component-consolidation/24-RESEARCH.md
@.planning/phases/24-layout-component-consolidation/24-01-SUMMARY.md

# Existing components to preserve behavior from:
@apps/web/src/components/admin/sidebar.tsx
@apps/web/src/components/profile/theme-picker.tsx
@apps/web/src/components/profile/profile-settings-dialog.tsx
@apps/web/src/components/sync/sync-status-indicator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create unified AppSidebar component</name>
  <files>apps/web/src/components/layout/app-sidebar.tsx</files>
  <action>
    Create `apps/web/src/components/layout/app-sidebar.tsx` — a unified sidebar component that replaces the three duplicate sidebar implementations.

    Create the `components/layout/` directory if it doesn't exist.

    The component must:

    1. **Accept props:** `navItems: NavItem[]`, `dashboardTitle: string`, `showSyncStatus?: boolean` (default false)
    2. **Use shadcn/ui Sidebar primitives:** Import Sidebar, SidebarContent, SidebarHeader, SidebarFooter, SidebarMenu, SidebarMenuItem, SidebarMenuButton from `@/components/ui/sidebar`
    3. **Render Lucide React icons dynamically:** Import icons from `lucide-react` using the icon name from NavItem. Use pattern: `import * as LucideIcons from "lucide-react"` then `const Icon = LucideIcons[item.icon as keyof typeof LucideIcons] as React.ElementType`
    4. **Active state logic:** Match current admin sidebar logic:
       - For indent items: exact pathname match only
       - For dashboard roots ("/admin", "/va", "/client"): exact match only
       - For other items: exact match OR pathname starts with href + "/" (but not if a child indent item matches exactly)
    5. **Sidebar header:** Show "DS-ProSolution" title and dashboardTitle subtitle, with border-b border-border
    6. **Sidebar footer** (border-t border-border, space-y-2, p-4):
       - If `showSyncStatus` is true: render `<SyncStatusIndicator />`
       - Theme toggle: Popover with ThemePickerCompact (exact same pattern as current admin sidebar)
       - Profile Settings button: opens ProfileSettingsDialog (managed via local useState)
    7. **Use Lucide icons for footer buttons:** Replace inline SVG for theme (use `Palette` icon) and settings (use `Settings` icon)
    8. **Use semantic color tokens:** Replace hardcoded grays (text-gray-300, bg-gray-800, etc.) with semantic tokens (text-foreground, text-muted-foreground, hover:bg-accent, border-border). The shadcn/ui SidebarMenuButton handles active styling automatically via `isActive` prop.
    9. **Mark as "use client"** since it uses hooks (usePathname, useState)

    Style the nav items with: `flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors`
    For indent items add: `ml-4 text-xs`

    The footer buttons should use: `flex items-center gap-3 px-4 py-3 w-full rounded-lg text-sm font-medium text-foreground hover:bg-accent transition-colors`

    IMPORTANT: The component must render `<ProfileSettingsDialog>` as a sibling to `<Sidebar>`, wrapped in a fragment `<>...</>`, exactly like the current admin sidebar does. This is because the dialog needs to be outside the sidebar DOM tree.
  </action>
  <verify>
    - `ls apps/web/src/components/layout/app-sidebar.tsx` confirms file exists
    - `grep "AppSidebar" apps/web/src/components/layout/app-sidebar.tsx` finds the export
    - `grep "ThemePickerCompact" apps/web/src/components/layout/app-sidebar.tsx` confirms theme toggle is included
    - `grep "ProfileSettingsDialog" apps/web/src/components/layout/app-sidebar.tsx` confirms profile settings is included
    - `grep "SyncStatusIndicator" apps/web/src/components/layout/app-sidebar.tsx` confirms sync status support
    - `grep "SidebarMenuButton" apps/web/src/components/layout/app-sidebar.tsx` confirms using shadcn/ui primitives
    - `grep "lucide-react" apps/web/src/components/layout/app-sidebar.tsx` confirms Lucide icon usage
    - `cd apps/web && npx tsc --noEmit --pretty 2>&1 | head -30` shows no type errors
  </verify>
  <done>AppSidebar component is created, uses shadcn/ui Sidebar primitives, renders Lucide React icons from NavItem config, includes theme toggle popover, Profile Settings button, and optional SyncStatusIndicator. All hardcoded gray colors replaced with semantic tokens.</done>
</task>

<task type="auto">
  <name>Task 2: Create BreadcrumbNav and PageHeader layout components</name>
  <files>
    apps/web/src/components/layout/breadcrumb-nav.tsx
    apps/web/src/components/layout/page-header.tsx
  </files>
  <action>
    **1. Create `apps/web/src/components/layout/breadcrumb-nav.tsx`:**

    A "use client" component that dynamically generates breadcrumbs from the current pathname.

    Implementation:
    - Import `usePathname` from `next/navigation`
    - Import shadcn/ui breadcrumb primitives: Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbPage, BreadcrumbSeparator
    - Define `segmentLabels` map for human-readable labels:
      ```
      admin -> "Admin"
      va -> "VA"
      client -> "Client"
      users -> "Manage Users"
      accounts -> "Manage Accounts" (for admin) or just capitalize (generic)
      department-roles -> "Access Profiles"
      invites -> "Manage Invites"
      order-tracking -> "Order Tracking"
      automation -> "Extension Hub"
      bookkeeping -> "Order Tracking"
      ```
    - Guard: `if (!pathname) return null` (SSR safety)
    - Split pathname into segments, filter empty strings AND route groups (segments starting with "(")
    - If segments.length <= 1, return null (don't show breadcrumbs on dashboard root)
    - Map segments to BreadcrumbItem components:
      - Build href from segments up to current index
      - Use segmentLabels lookup, fallback to capitalize + replace hyphens with spaces
      - Last segment: BreadcrumbPage (not clickable)
      - Other segments: BreadcrumbLink (clickable)
      - Add BreadcrumbSeparator between items (not after last)
    - Wrap in `<Breadcrumb className="mb-4">` for bottom margin before page content

    **2. Create `apps/web/src/components/layout/page-header.tsx`:**

    A simple component (NO "use client" needed — it's a presentational component that can work as server or client).

    Props interface:
    ```typescript
    interface PageHeaderProps {
      title: string
      description?: string
      actions?: ReactNode
      className?: string
    }
    ```

    Implementation:
    - Flex container with items-start, justify-between, gap-4, mb-6
    - Left side: h1 with text-3xl font-bold, optional description p with text-muted-foreground
    - Right side: optional actions div with flex items-center gap-2
    - Use `cn()` to merge className prop

    NOTE: Do NOT add "use client" to page-header.tsx. It uses no hooks or browser APIs. It should work in both server and client components.
  </action>
  <verify>
    - `ls apps/web/src/components/layout/breadcrumb-nav.tsx` confirms file exists
    - `ls apps/web/src/components/layout/page-header.tsx` confirms file exists
    - `grep "BreadcrumbNav" apps/web/src/components/layout/breadcrumb-nav.tsx` finds the export
    - `grep "PageHeader" apps/web/src/components/layout/page-header.tsx` finds the export
    - `grep "usePathname" apps/web/src/components/layout/breadcrumb-nav.tsx` confirms dynamic path usage
    - `grep "use client" apps/web/src/components/layout/page-header.tsx` should NOT match (server-compatible)
    - `cd apps/web && npx tsc --noEmit --pretty 2>&1 | head -30` shows no type errors
  </verify>
  <done>BreadcrumbNav dynamically generates breadcrumbs from pathname with custom labels and route group filtering. PageHeader provides consistent title/description/actions pattern. Both components type-check cleanly.</done>
</task>

</tasks>

<verification>
1. All 3 layout component files exist in `components/layout/`
2. AppSidebar imports and uses shadcn/ui Sidebar primitives (not raw HTML)
3. AppSidebar uses Lucide React icons (no inline SVGs)
4. AppSidebar includes theme toggle, profile settings, and optional sync status
5. BreadcrumbNav handles edge cases: null pathname, single-segment paths, route groups
6. PageHeader is server-component compatible (no "use client")
7. `npx tsc --noEmit` passes with no errors in new files
</verification>

<success_criteria>
- AppSidebar is a drop-in replacement for AdminSidebar, VA inline sidebar, and Client inline sidebar
- BreadcrumbNav works on any route with automatic label resolution
- PageHeader provides consistent visual hierarchy for page titles
- All components use semantic color tokens (no hardcoded grays)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-layout-component-consolidation/24-02-SUMMARY.md`
</output>
