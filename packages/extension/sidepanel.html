<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DS-Pro Automation Hub</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <h1>DS-Pro Hub</h1>
      <div id="status-badge" class="status-badge stopped">Stopped</div>
    </header>

    <!-- Request Access Section (initial state when unpaired) -->
    <section id="request-access-section" class="section hidden">
      <h2>Connect Extension</h2>
      <p class="help-text">Request access to connect this extension to the automation hub</p>
      <div class="device-id-row">
        <span class="label">Device ID:</span>
        <code id="device-id-display">—</code>
      </div>
      <!-- Detected Accounts -->
      <div id="detected-accounts" class="detected-accounts hidden">
        <p class="detected-label">Detected Accounts:</p>
        <div id="detected-ebay" class="detected-account hidden">
          <span class="provider-badge ebay">eBay</span>
          <span id="detected-ebay-name"></span>
        </div>
        <div id="detected-amazon" class="detected-account hidden">
          <span class="provider-badge amazon">Amazon</span>
          <span id="detected-amazon-name"></span>
        </div>
      </div>
      <button id="btn-request-access" class="btn btn-primary btn-full">Request Access</button>
      <div id="request-error" class="error hidden"></div>
    </section>

    <!-- Detecting Accounts Section (shown while detection window is open) -->
    <section id="detecting-section" class="section hidden">
      <div class="detecting-content">
        <div class="spinner"></div>
        <h3>Detecting Accounts</h3>
        <p class="help-text">Opening eBay and Amazon to detect logged-in accounts...</p>
        <p class="help-text text-small">This may take a few seconds.</p>
      </div>
    </section>

    <!-- Pending Approval Section (polling for admin approval) -->
    <section id="pending-section" class="section hidden">
      <h2>Pending Approval</h2>
      <div class="pending-state">
        <div class="spinner"></div>
        <p>Waiting for admin approval...</p>
        <div class="device-id-row">
          <span class="label">Device ID:</span>
          <code id="pending-device-id">—</code>
        </div>
        <p class="help-text">Expires in: <span id="expiration-timer">--:--</span></p>
      </div>
    </section>

    <!-- Cooldown Section (rate limited) -->
    <section id="cooldown-section" class="section hidden">
      <h2>Please Wait</h2>
      <div class="cooldown-state">
        <p>You can request access again in:</p>
        <div id="cooldown-timer" class="countdown">--:--</div>
      </div>
    </section>

    <!-- Rejected Section -->
    <section id="rejected-section" class="section hidden">
      <h2>Request Rejected</h2>
      <div class="rejected-state">
        <p class="blocked-text">Your access request was rejected.</p>
        <p id="rejected-reason" class="help-text"></p>
        <button class="btn btn-secondary btn-full btn-try-again">Try Again</button>
      </div>
    </section>

    <!-- Expired Section -->
    <section id="expired-section" class="section hidden">
      <h2>Request Expired</h2>
      <div class="expired-state">
        <p class="help-text">Your access request expired. Please try again.</p>
        <button class="btn btn-primary btn-full btn-try-again">Request Access Again</button>
      </div>
    </section>

    <!-- Auto-Approved Section (auto-reconnect success) -->
    <section id="auto-approved-section" class="section hidden">
      <h2>Connected!</h2>
      <div class="success-state">
        <div class="success-icon">✓</div>
        <p>Recognized your account and connected automatically.</p>
        <p id="auto-approved-account" class="account-name"></p>
      </div>
    </section>

    <!-- Clock In Section (after pairing approved, before hub access) -->
    <section id="clock-in-section" class="section hidden">
      <h2>Clock In</h2>
      <div class="clock-in-form">
        <div class="input-group">
          <input
            type="password"
            id="access-code-input"
            placeholder="Enter access code"
            autocomplete="off"
            spellcheck="false"
          />
          <button id="btn-toggle-code-visibility" class="btn-icon" title="Show/hide code">
            <span class="icon-eye">&#128065;</span>
          </button>
        </div>
        <button id="btn-clock-in" class="btn btn-primary btn-full">Clock In</button>
        <div id="clock-in-error" class="error hidden"></div>
      </div>
    </section>

    <!-- Clocked Out Section (after inactivity or manual clock out) -->
    <section id="clocked-out-section" class="section hidden">
      <h2>Session Ended</h2>
      <div class="clocked-out-state">
        <p id="clocked-out-message">You have been clocked out.</p>
        <button id="btn-clock-in-again" class="btn btn-primary btn-full">Clock In Again</button>
      </div>
    </section>

    <!-- Main Hub (shown when paired) -->
    <div id="hub-section" class="hidden">
      <!-- Profile/Identity Section -->
      <section class="profile-section">
        <div class="profile-info">
          <span id="profile-name" class="profile-name">User</span>
          <span id="profile-type-badge" class="profile-type-badge">va</span>
          <span id="admin-badge" class="admin-badge hidden">Admin View</span>
        </div>
        <button id="btn-clock-out-header" class="btn btn-danger btn-small">Clock Out</button>
      </section>

      <!-- Tab Bar (dynamically rendered from roles) -->
      <nav id="tab-bar" class="tab-bar">
        <!-- Tabs rendered dynamically by JS -->
      </nav>

      <!-- Tab Bar Skeleton (shown while loading) -->
      <nav id="tab-bar-skeleton" class="tab-bar-skeleton hidden">
        <div class="skeleton-tab"></div>
        <div class="skeleton-tab"></div>
      </nav>

      <!-- Tab Content Container -->
      <div id="tab-content" class="tab-content">
        <!-- Content for active tab (placeholder for now) -->
        <p class="tab-placeholder">Feature content will appear here</p>
      </div>

      <!-- Empty State (for VAs with no roles) -->
      <section id="empty-state" class="empty-state-section hidden">
        <p class="empty-state-message">No features assigned. Contact your admin.</p>
      </section>

      <!-- Agent Info -->
      <section class="section agent-info-card">
        <div class="agent-info-row">
          <span class="label">Label:</span>
          <span id="agent-label" class="value">—</span>
        </div>
        <div class="agent-info-row">
          <span class="label">Account:</span>
          <span id="account-name" class="value">—</span>
        </div>
        <div class="agent-info-row">
          <span class="label">Role:</span>
          <span id="agent-role" class="badge">—</span>
        </div>
      </section>

      <!-- Global Stats -->
      <section class="section stats">
        <div class="stat">
          <div class="stat-value" id="stat-active">0</div>
          <div class="stat-label">Active</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-queued">0</div>
          <div class="stat-label">Queued</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-attention">0</div>
          <div class="stat-label">Attention</div>
        </div>
      </section>

      <!-- Current Task -->
      <section class="section current-task hidden" id="current-task-section">
        <h2>Current Task</h2>
        <div class="task-card">
          <div class="task-header">
            <span id="task-type" class="task-type">—</span>
            <span id="task-elapsed" class="task-elapsed">0:00</span>
          </div>
          <div class="task-stage">
            <span class="label">Stage:</span>
            <span id="task-stage-value">—</span>
          </div>
          <div class="task-action">
            <span class="label">Last:</span>
            <span id="task-last-action">—</span>
          </div>
          <div class="task-controls">
            <button id="btn-pause" class="btn btn-secondary">Pause</button>
            <button id="btn-focus-tab" class="btn btn-secondary">Focus Tab</button>
          </div>
        </div>
      </section>

      <!-- Attention Items -->
      <section class="section attention" id="attention-section">
        <h2>
          Needs Attention
          <span id="attention-count" class="count-badge">0</span>
        </h2>
        <div id="attention-list" class="attention-list">
          <div class="empty-state">No items need attention</div>
        </div>
      </section>

      <!-- Queue -->
      <section class="section queue">
        <h2>
          Queue
          <span id="queue-count" class="count-badge">0</span>
        </h2>
        <div id="queue-list" class="queue-list">
          <div class="empty-state">No tasks queued</div>
        </div>
      </section>

      <!-- Quick Actions -->
      <section class="section actions">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
          <button id="btn-start" class="btn btn-primary">Start</button>
          <button id="btn-pause-all" class="btn btn-secondary">Pause All</button>
          <button id="btn-emergency-stop" class="btn btn-danger">Emergency Stop</button>
        </div>
        <div class="action-buttons" style="margin-top: 8px;">
          <button id="btn-queue-fake" class="btn btn-secondary btn-small">+ Fake Task</button>
        </div>
      </section>

      <!-- Hotkeys Info -->
      <section class="section hotkeys">
        <h3>Hotkeys</h3>
        <div class="hotkey-row">
          <kbd>Ctrl+Shift+P</kbd>
          <span>Pause All</span>
        </div>
        <div class="hotkey-row">
          <kbd>Ctrl+Shift+X</kbd>
          <span>Emergency Stop</span>
        </div>
      </section>
    </div>
  </div>

  <!-- Validating Overlay -->
  <div id="validating-overlay" class="overlay hidden">
    <div class="overlay-content">
      <div class="spinner"></div>
      <p>Clocking in...</p>
    </div>
  </div>

  <!-- Inactivity Warning Toast -->
  <div id="inactivity-warning" class="warning-toast hidden">
    <span class="warning-icon">&#9888;</span>
    <span>Session expiring in <strong id="warning-minutes">5</strong> minutes</span>
    <button id="btn-dismiss-warning" class="btn-icon" title="Dismiss">&#10005;</button>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>
